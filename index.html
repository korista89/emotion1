<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê²½ì€ë°ì´í„°ë¶„ì„ PLUS</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<style>
:root{--primary:#4c5fd5;--accent:#0ea5e9;}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;margin:0;background:#f7f7fb;color:#0f172a}
header{background:linear-gradient(135deg,var(--primary),#7c3aed);color:#fff;padding:18px 20px}
header h1{margin:0;font-size:20px}
nav.tabs{display:flex;gap:8px;background:#fff;padding:8px 8px 0;border-bottom:1px solid #e5e7eb;position:sticky;top:0;z-index:10}
nav .tab{padding:10px 14px;border:1px solid #e5e7eb;border-bottom:none;border-top-left-radius:12px;border-top-right-radius:12px;background:#f9fafb;cursor:pointer;font-size:14px}
nav .tab.active{background:#fff;font-weight:600;color:#111827}
section.tabpanel{display:none;padding:16px}
section.tabpanel.active{display:block}
.container{max-width:1400px;margin:14px auto;background:#fff;border-radius:16px;box-shadow:0 12px 32px rgba(0,0,0,.08);overflow:hidden}
.controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
select,button{padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;background:#fff;font-size:14px}
label{font-weight:600}
.canvas-wrap{position:relative;background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:10px}
.note{font-size:12px;color:#475569;margin-top:8px}
/* Zoom overlay for THIS parent page */
.zoom-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:9999}
.zoom-box{background:#fff;padding:8px;border-radius:12px;max-width:96vw;max-height:92vh;box-shadow:0 10px 40px rgba(0,0,0,.5)}
.zoom-box img{display:block;max-width:95vw;max-height:90vh}
.zoom-close{position:absolute;top:14px;right:20px;font-size:28px;color:#fff;cursor:pointer}
footer{text-align:center;color:#64748b;font-size:12px;padding:16px 0}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
<header>
  <h1>ê²½ì€ë°ì´í„°ë¶„ì„ PLUS</h1>
</header>

<div class="container">
  <nav class="tabs">
    <div class="tab active" data-for="legacy">ê¸°ì¡´ ëŒ€ì‹œë³´ë“œ</div>
    <div class="tab" data-for="studentChart">í•™ìƒë³„ ìœ„ê¸°í–‰ë™ ë°œìƒë¹ˆë„ ê·¸ë˜í”„</div>
  </nav>

  <section id="legacy" class="tabpanel active">
    <div style="height:78vh">
      <iframe id="legacyFrame" title="ê²½ì€ë°ì´í„°ë¶„ì„(ì›ë³¸)" srcdoc="&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;ko&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot; /&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;/&gt;
  &lt;title&gt;PBS í†µí•© ë¶„ì„ ëŒ€ì‹œë³´ë“œ v3.5-enhanced&lt;/title&gt;
  &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js&quot;&gt;&lt;/script&gt;
  &lt;style&gt;
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 20px;
      font-family: &#x27;Malgun Gothic&#x27;, &#x27;ë§‘ì€ ê³ ë”•&#x27;, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh; color: #222;
    }
    .container { max-width: 1600px; margin: 0 auto; }
    .panel {
      background: #fff; border-radius: 14px; padding: 20px; margin-bottom: 20px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.08);
    }
    h1 { margin: 0 0 8px; }
    .muted { color: #666; font-size: 14px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .col { flex: 1; min-width: 220px; }
    label { display:block; font-weight:700; color:#444; margin: 6px 0; }
    input, select, textarea, button {
      width: 100%; padding: 10px 12px; border-radius: 10px; border: 2px solid #E6E8EE;
      font-size:14px; background:#fff;
    }
    input:focus, select:focus, textarea:focus { outline: none; border-color:#667eea; }
    button { cursor: pointer; background:#667eea; color:#fff; font-weight:700; transition: .2s; }
    button:hover { transform: translateY(-1px); background:#5a67d8; }
    .btn-ghost { background: #fff; color:#667eea; border-color:#667eea; }
    .btn-ghost:hover { background:#EEF0FF; }
    .actions { display:flex; gap:8px; }
    .hidden { display: none !important; }
    .grid { display: grid; gap: 16px; }
    .grid-3 { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
    .grid-2 { grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); }
    .grid-4 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
    .stat {
      background:#f7f9ff; padding:18px; border:1px solid #E6E8EE; border-radius:12px;
    }
    .stat .value { font-size: 34px; font-weight: 800; color:#3f51b5; }
    .stat .label { color:#666; font-size: 12px; margin-top:4px; }
    .tabs { display:flex; gap:6px; border-bottom:2px solid #E6E8EE; margin-bottom: 16px; }
    .tab { background:transparent; color:#666; border:none; padding:10px 14px; font-weight:800; }
    .tab.active { color:#3f51b5; border-bottom: 3px solid #3f51b5; }
    .tab-content { display:none; }
    .tab-content.active { display:block; }
    .chart-container { position:relative; height:320px; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:700; }
    .tier1 { background:#C6F6D5; color:#22543d; }
    .tier2 { background:#FED7AA; color:#7c2d12; }
    .tier3 { background:#FED7D7; color:#742a2a; }
    .student-card { border:1px solid #E6E8EE; border-radius:12px; padding:12px; background:#FAFBFF; margin-bottom:10px; }
    .student-card a { color:#3f51b5; font-weight:800; text-decoration:none; }
    .rec { background:#FFF7E6; border-left:4px solid #ff9800; padding:12px; border-radius:8px; margin:10px 0; }
    .small { font-size:12px; color:#666; }
    .footer { text-align:center; color:#fff; font-size:12px; margin-top: 10px; }
    .modal { position:fixed; inset:0; background:rgba(0,0,0,.4); display:none; align-items:center; justify-content:center; padding: 20px; z-index: 1000; }
    .modal .dialog { background:#fff; border-radius:16px; width:min(1200px, 95vw); max-height: 90vh; overflow:auto; padding: 20px; }
    .modal h3 { margin-top:0; }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { border:1px solid #E6E8EE; padding:8px 10px; font-size:13px; }
    .link-row { display:flex; gap:8px; flex-wrap: wrap; margin-top: 8px; }
    .analysis-section { background:#f0f4ff; padding:16px; border-radius:10px; margin:12px 0; }
    .insight-box { background:#e8f5e9; padding:12px; border-radius:8px; margin:8px 0; }
    @media print {
      body { background: white; }
      .panel { box-shadow: none; border: 1px solid #ddd; }
      .chart-container { page-break-inside: avoid; }
      .actions, .btn-ghost, button { display: none !important; }
    }
  &lt;/style&gt;

&lt;style&gt;
.ke-zoom-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:99999}
.ke-zoom-box{background:white;padding:8px;border-radius:12px;max-width:96vw;max-height:92vh;box-shadow:0 10px 40px rgba(0,0,0,.5)}
.ke-zoom-box img{display:block;max-width:95vw;max-height:90vh;height:auto;width:auto}
.ke-zoom-close{position:absolute;top:14px;right:20px;font-size:28px;color:#fff;cursor:pointer}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class=&quot;container&quot;&gt;
    &lt;div class=&quot;panel&quot;&gt;
      &lt;h1&gt;ğŸ¯ PBS í†µí•© ë¶„ì„ ëŒ€ì‹œë³´ë“œ v3.5-enhanced&lt;/h1&gt;
      &lt;p class=&quot;muted&quot;&gt;CSV ì—…ë¡œë“œ/ë¶™ì—¬ë„£ê¸° â†’ í•„ë“œ ë§¤í•‘ â†’ ê¸°ê°„ ì„¤ì • â†’ ë¶„ì„ ì‹œì‘. ì§‘ì¤‘ ê¸°ê°„ ë‚´ &#x27;ìµœì´ˆ ì„ê³„ ë„ë‹¬(Threshold crossing)&#x27; í•™ìƒì— ğŸ””.&lt;/p&gt;
      &lt;div class=&quot;row&quot;&gt;
        &lt;div class=&quot;col&quot;&gt;
          &lt;label&gt;ì „ì²´ í•™ìƒ ìˆ˜ (Total students)&lt;/label&gt;
          &lt;input id=&quot;totalStudents&quot; type=&quot;number&quot; value=&quot;100&quot; placeholder=&quot;ì˜ˆ: 100&quot;/&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col&quot;&gt;
          &lt;label&gt;ë°ì´í„° ì†ŒìŠ¤ (Data source)&lt;/label&gt;
          &lt;div class=&quot;actions&quot;&gt;
            &lt;button onclick=&quot;loadSample()&quot;&gt;ğŸ“Š ìƒ˜í”Œ ë°ì´í„°&lt;/button&gt;
            &lt;button class=&quot;btn-ghost&quot; onclick=&quot;document.getElementById(&#x27;fileInput&#x27;).click()&quot;&gt;ğŸ“ íŒŒì¼&lt;/button&gt;
            &lt;button class=&quot;btn-ghost&quot; onclick=&quot;togglePaste()&quot;&gt;ğŸ“‹ ë¶™ì—¬ë„£ê¸°&lt;/button&gt;
          &lt;/div&gt;
          &lt;input id=&quot;fileInput&quot; type=&quot;file&quot; accept=&quot;.csv,.tsv&quot; class=&quot;hidden&quot;/&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div id=&quot;pastePanel&quot; class=&quot;row hidden&quot; style=&quot;margin-top:10px;&quot;&gt;
        &lt;div class=&quot;col&quot;&gt;
          &lt;textarea id=&quot;pasteData&quot; rows=&quot;6&quot; placeholder=&quot;ì—¬ê¸°ì— CSVë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. (í—¤ë” í¬í•¨)&quot;&gt;&lt;/textarea&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col&quot; style=&quot;max-width:220px;&quot;&gt;
          &lt;button onclick=&quot;parsePaste()&quot;&gt;íŒŒì‹±(Parse)&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div id=&quot;status&quot; class=&quot;muted&quot; style=&quot;margin-top:8px;&quot;&gt;ìƒíƒœ: ëŒ€ê¸°&lt;/div&gt;
    &lt;/div&gt;

    &lt;div id=&quot;mapPanel&quot; class=&quot;panel hidden&quot;&gt;
      &lt;h2&gt;ğŸ—‚ï¸ ë°ì´í„° ë§¤í•‘ (Field Mapping)&lt;/h2&gt;
      &lt;div class=&quot;grid grid-3&quot;&gt;
        &lt;div&gt;&lt;label&gt;ë‚ ì§œ(Date)*&lt;/label&gt;&lt;select id=&quot;mapDate&quot;&gt;&lt;/select&gt;&lt;/div&gt;
        &lt;div&gt;&lt;label&gt;ì‹œê°„ëŒ€/ì‹œê°„(Time or Block)*&lt;/label&gt;&lt;select id=&quot;mapTime&quot;&gt;&lt;/select&gt;&lt;/div&gt;
        &lt;div&gt;&lt;label&gt;ìš”ì¼(Weekday)&lt;/label&gt;&lt;select id=&quot;mapDow&quot;&gt;&lt;/select&gt;&lt;/div&gt;
        &lt;div&gt;&lt;label&gt;í•™ìƒ(Student)*&lt;/label&gt;&lt;select id=&quot;mapStudent&quot;&gt;&lt;/select&gt;&lt;/div&gt;
        &lt;div&gt;&lt;label&gt;í–‰ë™(Behavior)*&lt;/label&gt;&lt;select id=&quot;mapBehavior&quot;&gt;&lt;/select&gt;&lt;/div&gt;
        &lt;div&gt;&lt;label&gt;ê°•ë„(Intensity 1-5)*&lt;/label&gt;&lt;select id=&quot;mapIntensity&quot;&gt;&lt;/select&gt;&lt;/div&gt;
        &lt;div&gt;&lt;label&gt;ê¸°ëŠ¥(Function)&lt;/label&gt;&lt;select id=&quot;mapFunction&quot;&gt;&lt;/select&gt;&lt;/div&gt;
        &lt;div&gt;&lt;label&gt;ì¥ì†Œ(Setting)&lt;/label&gt;&lt;select id=&quot;mapSetting&quot;&gt;&lt;/select&gt;&lt;/div&gt;
        &lt;div&gt;&lt;label&gt;ì„ í–‰ì‚¬ê±´(Antecedent)&lt;/label&gt;&lt;select id=&quot;mapAntecedent&quot;&gt;&lt;/select&gt;&lt;/div&gt;
        &lt;div&gt;&lt;label&gt;ê²°ê³¼(Consequence)&lt;/label&gt;&lt;select id=&quot;mapConsequence&quot;&gt;&lt;/select&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;div class=&quot;row&quot; style=&quot;margin-top:10px;&quot;&gt;
        &lt;div class=&quot;col&quot;&gt;
          &lt;label&gt;ì „ì²´ ë¶„ì„ ê¸°ê°„ (Full range)&lt;/label&gt;
          &lt;div class=&quot;row&quot; style=&quot;gap:6px;&quot;&gt;
            &lt;input id=&quot;startDate&quot; type=&quot;date&quot; value=&quot;2025-01-01&quot;/&gt;
            &lt;input id=&quot;endDate&quot; type=&quot;date&quot; value=&quot;2025-12-31&quot;/&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col&quot;&gt;
          &lt;label&gt;ì§‘ì¤‘ ë¶„ì„ ê¸°ê°„ (Focus window)&lt;/label&gt;
          &lt;div class=&quot;row&quot; style=&quot;gap:6px;&quot;&gt;
            &lt;input id=&quot;focusStart&quot; type=&quot;date&quot; value=&quot;2025-09-01&quot;/&gt;
            &lt;input id=&quot;focusEnd&quot; type=&quot;date&quot; value=&quot;2025-09-30&quot;/&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class=&quot;row&quot; style=&quot;margin-top:10px;&quot;&gt;
        &lt;div class=&quot;col&quot;&gt;
          &lt;label&gt;Tier2 ì„ê³„ê°’ (ê¸°ë³¸: 2íšŒ ì´ìƒ)&lt;/label&gt;
          &lt;input id=&quot;tier2Threshold&quot; type=&quot;number&quot; value=&quot;2&quot; min=&quot;1&quot;/&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col&quot;&gt;
          &lt;label&gt;Tier3 ì„ê³„ê°’ (ê¸°ë³¸: 4íšŒ ì´ìƒ)&lt;/label&gt;
          &lt;input id=&quot;tier3Threshold&quot; type=&quot;number&quot; value=&quot;4&quot; min=&quot;1&quot;/&gt;
        &lt;/div&gt;
        &lt;div class=&quot;col&quot; style=&quot;max-width:340px;&quot;&gt;
          &lt;button id=&quot;btnAnalyze&quot; onclick=&quot;runAnalysis()&quot; disabled&gt;ğŸš€ ë¶„ì„ ì‹œì‘(Analyze)&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;div id=&quot;dashboard&quot; class=&quot;panel hidden&quot;&gt;
      &lt;h2&gt;ğŸ“Š ë¶„ì„ ê²°ê³¼ (Results)&lt;/h2&gt;
      &lt;div class=&quot;tabs&quot;&gt;
        &lt;button class=&quot;tab active&quot; onclick=&quot;showTab(event,&#x27;overview&#x27;)&quot;&gt;ì „ì²´ í˜„í™©&lt;/button&gt;
        &lt;button class=&quot;tab&quot; onclick=&quot;showTab(event,&#x27;detail&#x27;)&quot;&gt;ìƒì„¸ ë¶„ì„&lt;/button&gt;
        &lt;button class=&quot;tab&quot; onclick=&quot;showTab(event,&#x27;tier2&#x27;)&quot;&gt;Tier 2 ê²€í† &lt;/button&gt;
        &lt;button class=&quot;tab&quot; onclick=&quot;showTab(event,&#x27;tier3&#x27;)&quot;&gt;Tier 3 ê²€í† &lt;/button&gt;
        &lt;button class=&quot;tab&quot; onclick=&quot;showTab(event,&#x27;patterns&#x27;)&quot;&gt;íŒ¨í„´ ë¶„ì„&lt;/button&gt;
      &lt;/div&gt;

      &lt;div id=&quot;overview&quot; class=&quot;tab-content active&quot;&gt;
        &lt;div class=&quot;grid grid-3&quot;&gt;
          &lt;div class=&quot;stat&quot;&gt;&lt;div class=&quot;value&quot; id=&quot;statTotalStudents&quot;&gt;0&lt;/div&gt;&lt;div class=&quot;label&quot;&gt;ì „ì²´ í•™ìƒ ìˆ˜&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;stat&quot;&gt;&lt;div class=&quot;value&quot; id=&quot;statUniqueStudents&quot;&gt;0&lt;/div&gt;&lt;div class=&quot;label&quot;&gt;ë°ì´í„°ê°€ ìˆëŠ” í•™ìƒ ìˆ˜&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;stat&quot;&gt;&lt;div class=&quot;value&quot; id=&quot;statIncidents&quot;&gt;0&lt;/div&gt;&lt;div class=&quot;label&quot;&gt;ì´ ë°œìƒ ê±´ìˆ˜&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;stat&quot;&gt;&lt;div class=&quot;value&quot; id=&quot;statAvgIntensity&quot;&gt;0&lt;/div&gt;&lt;div class=&quot;label&quot;&gt;í‰ê·  ê°•ë„&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;stat&quot;&gt;&lt;div class=&quot;value&quot; id=&quot;statPeakDay&quot;&gt;-&lt;/div&gt;&lt;div class=&quot;label&quot;&gt;ìµœë‹¤ ë°œìƒì¼&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;stat&quot;&gt;&lt;div class=&quot;value&quot; id=&quot;statTrend&quot;&gt;-&lt;/div&gt;&lt;div class=&quot;label&quot;&gt;ì£¼ê°„ ì¶”ì„¸&lt;/div&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;grid grid-4&quot; style=&quot;margin-top:14px;&quot;&gt;
          &lt;div class=&quot;panel&quot;&gt;&lt;h3&gt;í–‰ë™ìœ í˜•ë³„ ë°œìƒ&lt;/h3&gt;&lt;div class=&quot;chart-container&quot;&gt;&lt;canvas id=&quot;byBehavior&quot;&gt;&lt;/canvas&gt;&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;panel&quot;&gt;&lt;h3&gt;ìš”ì¼ë³„ ë°œìƒ&lt;/h3&gt;&lt;div class=&quot;chart-container&quot;&gt;&lt;canvas id=&quot;byWeekday&quot;&gt;&lt;/canvas&gt;&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;panel&quot;&gt;&lt;h3&gt;ì‹œê°„ëŒ€ë³„ ë°œìƒ&lt;/h3&gt;&lt;div class=&quot;chart-container&quot;&gt;&lt;canvas id=&quot;byTime&quot;&gt;&lt;/canvas&gt;&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;panel&quot;&gt;&lt;h3&gt;ê°•ë„ë³„ ë¶„í¬&lt;/h3&gt;&lt;div class=&quot;chart-container&quot;&gt;&lt;canvas id=&quot;byIntensity&quot;&gt;&lt;/canvas&gt;&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;panel&quot;&gt;&lt;h3&gt;ì¼ë³„ ì¶”ì´&lt;/h3&gt;&lt;div class=&quot;chart-container&quot;&gt;&lt;canvas id=&quot;byDate&quot;&gt;&lt;/canvas&gt;&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;panel&quot;&gt;&lt;h3&gt;ê¸°ëŠ¥ë³„ ë¶„í¬&lt;/h3&gt;&lt;div class=&quot;chart-container&quot;&gt;&lt;canvas id=&quot;byFunction&quot;&gt;&lt;/canvas&gt;&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;panel&quot;&gt;&lt;h3&gt;ì¥ì†Œë³„ ë°œìƒ&lt;/h3&gt;&lt;div class=&quot;chart-container&quot;&gt;&lt;canvas id=&quot;bySetting&quot;&gt;&lt;/canvas&gt;&lt;/div&gt;&lt;/div&gt;
          &lt;div class=&quot;panel&quot;&gt;&lt;h3&gt;ì£¼ê°„ ëˆ„ì  ì¶”ì´&lt;/h3&gt;&lt;div class=&quot;chart-container&quot;&gt;&lt;canvas id=&quot;weeklyTrend&quot;&gt;&lt;/canvas&gt;&lt;/div&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div id=&quot;detail&quot; class=&quot;tab-content&quot;&gt;
        &lt;h3&gt;BCBA Tier 1 ê¶Œê³ (Universal Supports)&lt;/h3&gt;
        &lt;div id=&quot;tier1Recs&quot; class=&quot;rec&quot;&gt;&lt;/div&gt;
        
        &lt;h3 style=&quot;margin-top:12px;&quot;&gt;ì˜ˆë°©ì  ì¤‘ì¬ ì „ëµ (Preventive Interventions)&lt;/h3&gt;
        &lt;div id=&quot;preventiveStrategies&quot; class=&quot;analysis-section&quot;&gt;&lt;/div&gt;
        
        &lt;h3 style=&quot;margin-top:12px;&quot;&gt;í™˜ê²½ ìˆ˜ì • ê¶Œê³  (Environmental Modifications)&lt;/h3&gt;
        &lt;div id=&quot;environmentRecs&quot; class=&quot;analysis-section&quot;&gt;&lt;/div&gt;
        
        &lt;div class=&quot;panel&quot;&gt;
          &lt;h3&gt;í•™ìƒë³„ ìƒì„¸ ë¶„ì„ (í´ë¦­ ì‹œ ê°œë³„ FBA)&lt;/h3&gt;
          &lt;div id=&quot;studentList&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div id=&quot;tier2&quot; class=&quot;tab-content&quot;&gt;
        &lt;div class=&quot;panel&quot;&gt;
          &lt;h3&gt;Tier 2 ëŒ€ìƒ í•™ìƒ (ì§‘ì¤‘ ê¸°ê°„ ìµœì´ˆ ì„ê³„ ë„ë‹¬ ğŸ”” í‘œì‹œ)&lt;/h3&gt;
          &lt;div id=&quot;tier2Content&quot;&gt;&lt;/div&gt;
          &lt;h3 style=&quot;margin-top:16px;&quot;&gt;Tier 2 ê·¸ë£¹ ì¤‘ì¬ ê¶Œê³ &lt;/h3&gt;
          &lt;div id=&quot;tier2GroupRecs&quot; class=&quot;analysis-section&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div id=&quot;tier3&quot; class=&quot;tab-content&quot;&gt;
        &lt;div class=&quot;panel&quot;&gt;
          &lt;h3&gt;Tier 3 ëŒ€ìƒ í•™ìƒ (ì§‘ì¤‘ ê¸°ê°„ ìµœì´ˆ ì„ê³„ ë„ë‹¬ ğŸ”” í‘œì‹œ)&lt;/h3&gt;
          &lt;div id=&quot;tier3Content&quot;&gt;&lt;/div&gt;
          &lt;h3 style=&quot;margin-top:16px;&quot;&gt;Tier 3 ê°œë³„í™” ì¤‘ì¬ ê¶Œê³ &lt;/h3&gt;
          &lt;div id=&quot;tier3IndividualRecs&quot; class=&quot;analysis-section&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div id=&quot;patterns&quot; class=&quot;tab-content&quot;&gt;
        &lt;div class=&quot;panel&quot;&gt;
          &lt;h3&gt;í–‰ë™ íŒ¨í„´ ë¶„ì„ (Behavioral Pattern Analysis)&lt;/h3&gt;
          &lt;div id=&quot;patternAnalysis&quot; class=&quot;analysis-section&quot;&gt;&lt;/div&gt;
          &lt;h3 style=&quot;margin-top:16px;&quot;&gt;ì‹œê°„ëŒ€ë³„ ìœ„í—˜ë„ ë§¤íŠ¸ë¦­ìŠ¤&lt;/h3&gt;
          &lt;div id=&quot;riskMatrix&quot; class=&quot;analysis-section&quot;&gt;&lt;/div&gt;
          &lt;h3 style=&quot;margin-top:16px;&quot;&gt;ìƒê´€ê´€ê³„ ë¶„ì„&lt;/h3&gt;
          &lt;div id=&quot;correlationAnalysis&quot; class=&quot;analysis-section&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class=&quot;footer&quot;&gt;Â© 2025 PBS Dashboard â€¢ v3.5-enhanced â€¢ Keung-eun PBS System&lt;/div&gt;
  &lt;/div&gt;

  &lt;div id=&quot;modal&quot; class=&quot;modal&quot; onclick=&quot;closeModal(event)&quot;&gt;
    &lt;div class=&quot;dialog&quot; onclick=&quot;event.stopPropagation()&quot;&gt;
      &lt;div style=&quot;display:flex; justify-content:space-between; align-items:center;&quot;&gt;
        &lt;h3 id=&quot;modalTitle&quot;&gt;FBA ìƒì„¸ ë¶„ì„&lt;/h3&gt;
        &lt;button class=&quot;btn-ghost&quot; style=&quot;width:auto;&quot; onclick=&quot;hideModal()&quot;&gt;ë‹«ê¸°&lt;/button&gt;
      &lt;/div&gt;
      &lt;div id=&quot;modalBody&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

&lt;script&gt;
  const $ = (id) =&gt; document.getElementById(id);

  // Chart.js default settings for print
  Chart.defaults.plugins.legend.display = true;
  Chart.defaults.plugins.tooltip.enabled = true;
  Chart.defaults.scale.ticks.autoSkip = false;
  Chart.defaults.scale.ticks.maxRotation = 45;
  Chart.defaults.scale.ticks.minRotation = 0;

  const toDateKey = (v) =&gt; {
    if (!v) return null;
    if (/\d{4}-\d{2}-\d{2}/.test(v)) return v;
    const m = v.match(/(\d{4})\D+(\d{1,2})\D+(\d{1,2})/);
    if (m) {
      const y = m[1], mm = (&#x27;0&#x27; + m[2]).slice(-2), dd = (&#x27;0&#x27; + m[3]).slice(-2);
      return `${y}-${mm}-${dd}`;
    }
    const d = new Date(v);
    if (!isNaN(d.getTime())) {
      const y = d.getFullYear(), mm = (&#x27;0&#x27;+(d.getMonth()+1)).slice(-2), dd = (&#x27;0&#x27;+d.getDate()).slice(-2);
      return `${y}-${mm}-${dd}`;
    }
    return null;
  };

  let raw = []; let data = []; let charts = {};
  let focusStart, focusEnd;
  let tier2Threshold = 2;
  let tier3Threshold = 4;

  function togglePaste(){ $(&#x27;pastePanel&#x27;).classList.toggle(&#x27;hidden&#x27;); }

  function loadSample(){
    const students = [&#x27;ê¹€ë¯¼ì£¼&#x27;,&#x27;ì¥ì¬í˜•&#x27;,&#x27;ë°•ë¯¼í˜&#x27;,&#x27;ê¹€ì˜ë¯¼&#x27;,&#x27;ìœ¤ì„¸ë¯¼&#x27;,&#x27;ìµœìœ¤í˜¸&#x27;,&#x27;ì´ì„œì§„&#x27;,&#x27;ë°•ì§€ìš°&#x27;,&#x27;ì •í•˜ëŠ˜&#x27;,&#x27;ìµœë¯¼ì„œ&#x27;];
    const behaviors = [&#x27;ì‹ ì²´ì  ê³µê²©&#x27;,&#x27;ìí•´&#x27;,&#x27;ìˆ˜ì—…ë°©í•´&#x27;,&#x27;ì´íƒˆ&#x27;,&#x27;íŒŒê´´&#x27;,&#x27;ì–¸ì–´í­ë ¥&#x27;,&#x27;ê³¼ì œê±°ë¶€&#x27;,&#x27;ì†Œë¦¬ì§€ë¥´ê¸°&#x27;];
    const functions = [&#x27;ì„±ì¸ì˜ ê´€ì‹¬&#x27;,&#x27;ê³¼ì œ/ìš”êµ¬ íšŒí”¼&#x27;,&#x27;ìœ í˜•ë¬¼/í™œë™ íšë“&#x27;,&#x27;ê°ê° ì¶”êµ¬&#x27;,&#x27;ê°ê° íšŒí”¼&#x27;,&#x27;ë˜ë˜ ê´€ì‹¬&#x27;];
    const settings = [&#x27;êµì‹¤&#x27;,&#x27;ë³µë„&#x27;,&#x27;ì²´ìœ¡ê´€&#x27;,&#x27;ê¸‰ì‹ì‹¤&#x27;,&#x27;íŠ¹ë³„ì‹¤&#x27;,&#x27;í™”ì¥ì‹¤&#x27;,&#x27;ìš´ë™ì¥&#x27;,&#x27;ë„ì„œê´€&#x27;];
    const antecedents = [&#x27;ê³¼ì œ ì œì‹œ&#x27;,&#x27;ì „í™˜ ì‹œê°„&#x27;,&#x27;ë˜ë˜ ì ‘ê·¼&#x27;,&#x27;ì§€ì‹œ ì œê³µ&#x27;,&#x27;ì„ í˜¸ í™œë™ ì¢…ë£Œ&#x27;,&#x27;ëŒ€ê¸° ì‹œê°„&#x27;];
    const consequences = [&#x27;ê´€ì‹¬ ì œê³µ&#x27;,&#x27;ê³¼ì œ ì¤‘ë‹¨&#x27;,&#x27;íƒ€ì„ì•„ì›ƒ&#x27;,&#x27;ë¬´ì‹œ&#x27;,&#x27;ì¬ì§€ì‹œ&#x27;,&#x27;ë¬¼ê±´ ì œê³µ&#x27;];

    raw = [];
    const start = new Date(&#x27;2025-01-01&#x27;);
    for (let i=0;i&lt;250;i++){
      const d = new Date(start.getTime() + Math.random()*1000*60*60*24*330);
      const y = d.getFullYear(), m = (d.getMonth()+1), day=d.getDate();
      const hh = 9 + Math.floor(Math.random()*8);
      const timeBlock = `${hh}ì‹œ`;
      const dow = [&#x27;ì¼&#x27;,&#x27;ì›”&#x27;,&#x27;í™”&#x27;,&#x27;ìˆ˜&#x27;,&#x27;ëª©&#x27;,&#x27;ê¸ˆ&#x27;,&#x27;í† &#x27;][d.getDay()];
      raw.push({
        &#x27;ë‚ ì§œ&#x27;: `${y}. ${m}. ${day}`,
        &#x27;ì‹œê°„ëŒ€&#x27;: timeBlock,
        &#x27;ìš”ì¼&#x27;: dow,
        &#x27;í•™ìƒ&#x27;: students[Math.floor(Math.random()*students.length)],
        &#x27;í–‰ë™&#x27;: behaviors[Math.floor(Math.random()*behaviors.length)],
        &#x27;ê°•ë„&#x27;: 1 + Math.floor(Math.random()*5),
        &#x27;ê¸°ëŠ¥&#x27;: functions[Math.floor(Math.random()*functions.length)],
        &#x27;ì¥ì†Œ&#x27;: settings[Math.floor(Math.random()*settings.length)],
        &#x27;ì„ í–‰ì‚¬ê±´&#x27;: antecedents[Math.floor(Math.random()*antecedents.length)],
        &#x27;ê²°ê³¼&#x27;: consequences[Math.floor(Math.random()*consequences.length)]
      });
    }
    $(&#x27;status&#x27;).textContent = `ìƒ˜í”Œ ë°ì´í„° ${raw.length}í–‰ ë¡œë“œ`;
    setupMapping();
  }

  $(&#x27;fileInput&#x27;).addEventListener(&#x27;change&#x27;, (e)=&gt;{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = (ev)=&gt;{
      const result = Papa.parse(ev.target.result, { header:true, skipEmptyLines:true });
      raw = result.data;
      $(&#x27;status&#x27;).textContent = `${file.name}ì—ì„œ ${raw.length}í–‰ ë¡œë“œ`;
      setupMapping();
    };
    reader.readAsText(file);
  });

  function parsePaste(){
    const text = $(&#x27;pasteData&#x27;).value.trim();
    if(!text){ alert(&#x27;ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.&#x27;); return; }
    const result = Papa.parse(text, { header:true, skipEmptyLines:true });
    raw = result.data;
    $(&#x27;status&#x27;).textContent = `ë¶™ì—¬ë„£ê¸°ì—ì„œ ${raw.length}í–‰ ë¡œë“œ`;
    setupMapping();
  }

  function fillSelect(selId, headers, autoKeys){
    const sel = $(selId);
    sel.innerHTML = &#x27;&lt;option value=&quot;&quot;&gt;ì„ íƒ&lt;/option&gt;&#x27;;
    headers.forEach(h=&gt;{
      const opt = document.createElement(&#x27;option&#x27;);
      opt.value = h; opt.textContent = h;
      sel.appendChild(opt);
    });
    for(const key of autoKeys){
      const found = headers.find(h=&gt; h.includes(key));
      if(found){ sel.value = found; break; }
    }
    sel.onchange = checkReady;
  }

  function setupMapping(){
    if(!raw || raw.length===0) return;
    $(&#x27;mapPanel&#x27;).classList.remove(&#x27;hidden&#x27;);
    const headers = Object.keys(raw[0]);
    fillSelect(&#x27;mapDate&#x27;, headers, [&#x27;ë‚ ì§œ&#x27;,&#x27;date&#x27;,&#x27;ì¼&#x27;]);
    fillSelect(&#x27;mapTime&#x27;, headers, [&#x27;ì‹œê°„ëŒ€&#x27;,&#x27;ì‹œê°„&#x27;,&#x27;ì‹œëŒ€&#x27;,&#x27;time&#x27;]);
    fillSelect(&#x27;mapDow&#x27;, headers, [&#x27;ìš”ì¼&#x27;,&#x27;dow&#x27;]);
    fillSelect(&#x27;mapStudent&#x27;, headers, [&#x27;í•™ìƒ&#x27;,&#x27;ì´ë¦„&#x27;,&#x27;student&#x27;]);
    fillSelect(&#x27;mapBehavior&#x27;, headers, [&#x27;í–‰ë™&#x27;,&#x27;problem&#x27;,&#x27;behavior&#x27;]);
    fillSelect(&#x27;mapIntensity&#x27;, headers, [&#x27;ê°•ë„&#x27;,&#x27;ì ìˆ˜&#x27;,&#x27;intensity&#x27;,&#x27;severity&#x27;]);
    fillSelect(&#x27;mapFunction&#x27;, headers, [&#x27;ê¸°ëŠ¥&#x27;,&#x27;function&#x27;]);
    fillSelect(&#x27;mapSetting&#x27;, headers, [&#x27;ì¥ì†Œ&#x27;,&#x27;setting&#x27;,&#x27;ìœ„ì¹˜&#x27;,&#x27;êµì‹¤&#x27;]);
    fillSelect(&#x27;mapAntecedent&#x27;, headers, [&#x27;ì„ í–‰&#x27;,&#x27;antecedent&#x27;,&#x27;ì „&#x27;]);
    fillSelect(&#x27;mapConsequence&#x27;, headers, [&#x27;ê²°ê³¼&#x27;,&#x27;consequence&#x27;,&#x27;í›„&#x27;]);
    checkReady();
  }

  function checkReady(){
    const req = [&#x27;mapDate&#x27;,&#x27;mapTime&#x27;,&#x27;mapStudent&#x27;,&#x27;mapBehavior&#x27;,&#x27;mapIntensity&#x27;];
    const ok = req.every(id =&gt; $(id).value);
    $(&#x27;btnAnalyze&#x27;).disabled = !ok;
  }

  function runAnalysis(){
    const totalStudents = parseInt($(&#x27;totalStudents&#x27;).value)||0;
    focusStart = $(&#x27;focusStart&#x27;).value;
    focusEnd = $(&#x27;focusEnd&#x27;).value;
    tier2Threshold = parseInt($(&#x27;tier2Threshold&#x27;).value) || 2;
    tier3Threshold = parseInt($(&#x27;tier3Threshold&#x27;).value) || 4;

    const kDate = $(&#x27;mapDate&#x27;).value;
    const kTime = $(&#x27;mapTime&#x27;).value;
    const kDow = $(&#x27;mapDow&#x27;).value;
    const kStudent = $(&#x27;mapStudent&#x27;).value;
    const kBehavior = $(&#x27;mapBehavior&#x27;).value;
    const kIntensity = $(&#x27;mapIntensity&#x27;).value;
    const kFunction = $(&#x27;mapFunction&#x27;).value;
    const kSetting = $(&#x27;mapSetting&#x27;).value;
    const kAntecedent = $(&#x27;mapAntecedent&#x27;).value;
    const kConsequence = $(&#x27;mapConsequence&#x27;).value;

    data = raw.map(r=&gt; ({
      dateKey: toDateKey(r[kDate]),
      time: (r[kTime]||&#x27;&#x27;).toString(),
      dow: (r[kDow]||&#x27;&#x27;).toString(),
      student: (r[kStudent]||&#x27;&#x27;).toString(),
      behavior: (r[kBehavior]||&#x27;&#x27;).toString(),
      intensity: parseInt(r[kIntensity])||0,
      func: (r[kFunction]||&#x27;&#x27;).toString(),
      setting: (r[kSetting]||&#x27;&#x27;).toString(),
      antecedent: (r[kAntecedent]||&#x27;&#x27;).toString(),
      consequence: (r[kConsequence]||&#x27;&#x27;).toString()
    })).filter(d=&gt; d.dateKey);

    const s = $(&#x27;startDate&#x27;).value, e = $(&#x27;endDate&#x27;).value;
    const inRange = d =&gt; (!s || d.dateKey&gt;=s) &amp;&amp; (!e || d.dateKey&lt;=e);
    data = data.filter(inRange);

    const uniq = (arr)=&gt; Array.from(new Set(arr));
    const uniqueStudents = uniq(data.map(d=&gt;d.student)).filter(Boolean);

    // Calculate statistics
    const avgIntensity = data.length &gt; 0 ? (data.reduce((s,d)=&gt;s+d.intensity,0)/data.length).toFixed(2) : 0;
    const dateCount = countBy(data, d=&gt;d.dateKey);
    const peakDay = dateCount.labels[dateCount.counts.indexOf(Math.max(...dateCount.counts))] || &#x27;-&#x27;;
    
    // Calculate weekly trend
    const weeklyData = getWeeklyTrend(data);
    const trend = weeklyData.trend;

    $(&#x27;dashboard&#x27;).classList.remove(&#x27;hidden&#x27;);
    $(&#x27;statTotalStudents&#x27;).textContent = totalStudents;
    $(&#x27;statUniqueStudents&#x27;).textContent = uniqueStudents.length;
    $(&#x27;statIncidents&#x27;).textContent = data.length;
    $(&#x27;statAvgIntensity&#x27;).textContent = avgIntensity;
    $(&#x27;statPeakDay&#x27;).textContent = peakDay;
    $(&#x27;statTrend&#x27;).textContent = trend;

    // Draw 8 charts
    drawBar(&#x27;byBehavior&#x27;, countBy(data, d=&gt;d.behavior), &#x27;í–‰ë™ ìœ í˜•&#x27;);
    drawBar(&#x27;byWeekday&#x27;, countBy(data, d=&gt; mapWeekday(d)), &#x27;ìš”ì¼&#x27;);
    drawBar(&#x27;byTime&#x27;, countBy(data, d=&gt;d.time), &#x27;ì‹œê°„ëŒ€&#x27;);
    drawBar(&#x27;byIntensity&#x27;, countBy(data, d=&gt;String(d.intensity)), &#x27;ê°•ë„&#x27;);
    drawLine(&#x27;byDate&#x27;, countBy(data, d=&gt;d.dateKey, true), &#x27;ë‚ ì§œ&#x27;);
    drawPie(&#x27;byFunction&#x27;, countBy(data, d=&gt;d.func), &#x27;ê¸°ëŠ¥&#x27;);
    drawBar(&#x27;bySetting&#x27;, countBy(data, d=&gt;d.setting), &#x27;ì¥ì†Œ&#x27;);
    drawLine(&#x27;weeklyTrend&#x27;, weeklyData, &#x27;ì£¼ì°¨&#x27;);

    renderTiers();
    renderStudentList(uniqueStudents);
    renderTier1Recs();
    renderPreventiveStrategies();
    renderEnvironmentRecs();
    renderTier2GroupRecs();
    renderTier3IndividualRecs();
    renderPatternAnalysis();
    renderRiskMatrix();
    renderCorrelationAnalysis();
  }

  function getWeeklyTrend(data) {
    const weekMap = new Map();
    data.forEach(d =&gt; {
      const date = new Date(d.dateKey);
      const weekNum = getWeekNumber(date);
      const weekKey = `${date.getFullYear()}-W${weekNum}`;
      weekMap.set(weekKey, (weekMap.get(weekKey) || 0) + 1);
    });
    
    const sorted = Array.from(weekMap.entries()).sort((a,b) =&gt; a[0].localeCompare(b[0]));
    const labels = sorted.map(([k,v]) =&gt; k);
    const counts = sorted.map(([k,v]) =&gt; v);
    
    // Calculate trend
    let trend = &#x27;ì•ˆì •&#x27;;
    if (counts.length &gt;= 3) {
      const recent = counts.slice(-3);
      const avg = recent.reduce((a,b)=&gt;a+b,0)/3;
      const prevAvg = counts.slice(-6,-3).reduce((a,b)=&gt;a+b,0)/3 || avg;
      if (avg &gt; prevAvg * 1.2) trend = &#x27;ì¦ê°€â†‘&#x27;;
      else if (avg &lt; prevAvg * 0.8) trend = &#x27;ê°ì†Œâ†“&#x27;;
    }
    
    return { labels, counts, trend };
  }

  function getWeekNumber(d) {
    const date = new Date(d.getTime());
    date.setHours(0, 0, 0, 0);
    date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
    const week1 = new Date(date.getFullYear(), 0, 4);
    return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
  }

  function mapWeekday(d){
    if (d.dow) return d.dow.replace(&#x27;ìš”ì¼&#x27;,&#x27;&#x27;);
    const dt = new Date(d.dateKey);
    return [&#x27;ì¼&#x27;,&#x27;ì›”&#x27;,&#x27;í™”&#x27;,&#x27;ìˆ˜&#x27;,&#x27;ëª©&#x27;,&#x27;ê¸ˆ&#x27;,&#x27;í† &#x27;][dt.getDay()];
  }

  function countBy(arr, keyFn, sortByKey=false){
    const m = new Map();
    for(const x of arr){
      const k = keyFn(x) || &#x27;ê¸°íƒ€&#x27;;
      m.set(k, (m.get(k)||0)+1);
    }
    let labels = Array.from(m.keys());
    if(sortByKey) labels = labels.sort();
    const counts = labels.map(k=&gt; m.get(k));
    return { labels, counts };
  }

  function drawBar(canvasId, {labels, counts}, label=&#x27;ê±´ìˆ˜&#x27;){
    if(charts[canvasId]) charts[canvasId].destroy();
    const ctx = $(canvasId).getContext(&#x27;2d&#x27;);
    charts[canvasId] = new Chart(ctx, {
      type: &#x27;bar&#x27;,
      data: { 
        labels, 
        datasets: [{ 
          label: label, 
          data: counts, 
          backgroundColor:&#x27;rgba(102,126,234,.85)&#x27;,
          borderColor: &#x27;rgba(102,126,234,1)&#x27;,
          borderWidth: 1
        }]
      },
      options: { 
        responsive:true, 
        maintainAspectRatio:false,
        plugins: {
          legend: { display: true },
          datalabels: { display: true }
        },
        scales:{ 
          y:{ 
            beginAtZero:true,
            title: { display: true, text: &#x27;ë°œìƒ ê±´ìˆ˜&#x27; }
          },
          x: {
            title: { display: true, text: label }
          }
        } 
      }
    });
  }

  function drawLine(canvasId, {labels, counts}, label=&#x27;ë‚ ì§œ&#x27;){
    if(charts[canvasId]) charts[canvasId].destroy();
    const ctx = $(canvasId).getContext(&#x27;2d&#x27;);
    charts[canvasId] = new Chart(ctx, {
      type: &#x27;line&#x27;,
      data: { 
        labels, 
        datasets: [{ 
          label:&#x27;ë°œìƒ ê±´ìˆ˜&#x27;, 
          data: counts, 
          fill:false, 
          tension:.2,
          borderColor: &#x27;rgba(102,126,234,1)&#x27;,
          backgroundColor: &#x27;rgba(102,126,234,0.1)&#x27;
        }]
      },
      options: { 
        responsive:true, 
        maintainAspectRatio:false,
        plugins: {
          legend: { display: true }
        },
        scales:{ 
          y:{ 
            beginAtZero:true,
            title: { display: true, text: &#x27;ë°œìƒ ê±´ìˆ˜&#x27; }
          },
          x: {
            title: { display: true, text: label }
          }
        } 
      }
    });
  }

  function drawPie(canvasId, {labels, counts}, label=&#x27;ë¶„í¬&#x27;){
    if(charts[canvasId]) charts[canvasId].destroy();
    const ctx = $(canvasId).getContext(&#x27;2d&#x27;);
    const colors = [
      &#x27;rgba(255, 99, 132, 0.8)&#x27;,
      &#x27;rgba(54, 162, 235, 0.8)&#x27;,
      &#x27;rgba(255, 206, 86, 0.8)&#x27;,
      &#x27;rgba(75, 192, 192, 0.8)&#x27;,
      &#x27;rgba(153, 102, 255, 0.8)&#x27;,
      &#x27;rgba(255, 159, 64, 0.8)&#x27;
    ];
    charts[canvasId] = new Chart(ctx, {
      type: &#x27;pie&#x27;,
      data: { 
        labels, 
        datasets: [{ 
          label: label, 
          data: counts,
          backgroundColor: colors,
          borderColor: colors.map(c =&gt; c.replace(&#x27;0.8&#x27;, &#x27;1&#x27;)),
          borderWidth: 1
        }]
      },
      options: { 
        responsive:true, 
        maintainAspectRatio:false,
        plugins: {
          legend: { 
            display: true,
            position: &#x27;bottom&#x27;
          }
        }
      }
    });
  }

  function inFocus(d){ return (!focusStart || d.dateKey&gt;=focusStart) &amp;&amp; (!focusEnd || d.dateKey&lt;=focusEnd); }
  function beforeFocus(d){ return (focusStart &amp;&amp; d.dateKey &lt; focusStart); }

  function renderTiers(){
    const byStuTotal = {};
    const byStuBefore = {};
    const byStuFocus = {};
    for(const d of data){
      byStuTotal[d.student] = (byStuTotal[d.student]||0)+1;
      if(beforeFocus(d)) byStuBefore[d.student] = (byStuBefore[d.student]||0)+1;
      if(inFocus(d)) byStuFocus[d.student] = (byStuFocus[d.student]||0)+1;
    }

    const tier2Entries = Object.entries(byStuTotal).filter(([s,c])=&gt; c&gt;=tier2Threshold &amp;&amp; c&lt;tier3Threshold);
    const tier3Entries = Object.entries(byStuTotal).filter(([s,c])=&gt; c&gt;=tier3Threshold);

    const isFirstReachInFocus = (student, thr) =&gt; {
      const pre = byStuBefore[student] || 0;
      const focus = byStuFocus[student] || 0;
      return (pre &lt; thr) &amp;&amp; ((pre + focus) &gt;= thr) &amp;&amp; (focus &gt; 0);
    };

    const tier2Html = tier2Entries.map(([s,c])=&gt;{
      const bell = isFirstReachInFocus(s, tier2Threshold) ? &#x27; ğŸ””&#x27; : &#x27;&#x27;;
      const focusCount = byStuFocus[s] || 0;
      return `&lt;div class=&quot;student-card&quot;&gt;
        &lt;a href=&quot;#&quot; onclick=&quot;openFBA(&#x27;${s}&#x27;);return false;&quot;&gt;${s}&lt;/a&gt; 
        &lt;span class=&quot;pill tier2&quot;&gt;ì´ ${c}íšŒ&lt;/span&gt;
        &lt;span class=&quot;small&quot;&gt;(ì§‘ì¤‘ê¸°ê°„: ${focusCount}íšŒ)&lt;/span&gt;${bell}
      &lt;/div&gt;`;
    }).join(&#x27;&#x27;) || &#x27;&lt;p class=&quot;small&quot;&gt;í•´ë‹¹ ì—†ìŒ&lt;/p&gt;&#x27;;

    const tier3Html = tier3Entries.map(([s,c])=&gt;{
      const bell = isFirstReachInFocus(s, tier3Threshold) ? &#x27; ğŸ””&#x27; : &#x27;&#x27;;
      const focusCount = byStuFocus[s] || 0;
      return `&lt;div class=&quot;student-card&quot;&gt;
        &lt;a href=&quot;#&quot; onclick=&quot;openFBA(&#x27;${s}&#x27;);return false;&quot;&gt;${s}&lt;/a&gt; 
        &lt;span class=&quot;pill tier3&quot;&gt;ì´ ${c}íšŒ&lt;/span&gt;
        &lt;span class=&quot;small&quot;&gt;(ì§‘ì¤‘ê¸°ê°„: ${focusCount}íšŒ)&lt;/span&gt;${bell}
      &lt;/div&gt;`;
    }).join(&#x27;&#x27;) || &#x27;&lt;p class=&quot;small&quot;&gt;í•´ë‹¹ ì—†ìŒ&lt;/p&gt;&#x27;;

    $(&#x27;tier2Content&#x27;).innerHTML = tier2Html;
    $(&#x27;tier3Content&#x27;).innerHTML = tier3Html;
  }

  function renderStudentList(students){
    students.sort();
    const html = students.map(s=&gt; {
      const count = data.filter(d=&gt;d.student===s).length;
      return `&lt;div class=&quot;student-card&quot;&gt;
        &lt;a href=&quot;#&quot; onclick=&quot;openFBA(&#x27;${s}&#x27;);return false;&quot;&gt;${s}&lt;/a&gt;
        &lt;span class=&quot;small&quot;&gt;(${count}ê±´)&lt;/span&gt;
      &lt;/div&gt;`;
    }).join(&#x27;&#x27;);
    $(&#x27;studentList&#x27;).innerHTML = html || &#x27;&lt;p class=&quot;small&quot;&gt;í•™ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.&lt;/p&gt;&#x27;;
  }

  function intensityMean(arr){
    if(arr.length===0) return 0;
    return (arr.reduce((s,x)=&gt; s+(x.intensity||0),0)/arr.length).toFixed(2);
  }

  function summarize(arr, key){
    const m = new Map();
    for(const x of arr){
      const k = x[key] || (key===&#x27;func&#x27; ? &#x27;ê¸°ëŠ¥ ë¶ˆëª…&#x27; : &#x27;ê¸°íƒ€&#x27;);
      m.set(k, (m.get(k)||0)+1);
    }
    const sorted = Array.from(m.entries()).sort((a,b)=&gt; b[1]-a[1]);
    return sorted.slice(0,5).map(([k,c])=&gt; `${k}(${c})`).join(&#x27;, &#x27;) || &#x27;ìë£Œ ë¶€ì¡±&#x27;;
  }

  function functionKeyFromText(txt){
    if(!txt) return &#x27;unknown&#x27;;
    if (txt.includes(&#x27;ê´€ì‹¬&#x27;)) return &#x27;attention&#x27;;
    if (txt.includes(&#x27;íšŒí”¼&#x27;)) return &#x27;escape&#x27;;
    if (txt.includes(&#x27;ìœ í˜•&#x27;) || txt.includes(&#x27;íšë“&#x27;)) return &#x27;tangible&#x27;;
    if (txt.includes(&#x27;ê°ê°&#x27;)) {
      if (txt.includes(&#x27;ì¶”êµ¬&#x27;)) return &#x27;sensory_seek&#x27;;
      if (txt.includes(&#x27;íšŒí”¼&#x27;)) return &#x27;sensory_avoid&#x27;;
      return &#x27;sensory&#x27;;
    }
    if (txt.includes(&#x27;ë˜ë˜&#x27;)) return &#x27;peer&#x27;;
    return &#x27;unknown&#x27;;
  }

  function fctRecommendations(funcTop){
    const k = functionKeyFromText(funcTop);
    const recs = {
      &#x27;attention&#x27;: [
        &#x27;ëŒ€ì²´í–‰ë™: ì†ë“¤ê¸°/ì¹´ë“œ/ë²„ì € â†’ ì£¼ì˜ ì œê³µ(DRA)&#x27;,
        &#x27;ì„ í–‰ì‚¬ê±´: 3â€“5ë¶„ ì£¼ê¸° ë¯¸ë‹ˆì¹­ì°¬Â·í˜ì–´ë§&#x27;,
        &#x27;ê²°ê³¼ì „ëµ: ë¬¸ì œí–‰ë™ì—” ì£¼ì˜ ìµœì†Œí™”(Extinction), ëŒ€ì²´í–‰ë™ì—” ì¦‰ì‹œ ì£¼ì˜ ì œê³µ&#x27;,
        &#x27;í™˜ê²½: &quot;ê¸°ë‹¤ë ¤ìš”/ë§í•´ìš”&quot; ì¹´ë“œ ìƒì‹œ íœ´ëŒ€&#x27;,
        &#x27;ì¶”ê°€ì „ëµ: ë¹„ì¡°ê±´ì  ê´€ì‹¬ ì‹œê°„(NCR) ì„¤ì •&#x27;,
        &#x27;ë°ì´í„°: ì£¼ì˜ ì œê³µ ë¹ˆë„ ì²´í¬ë¦¬ìŠ¤íŠ¸ í™œìš©&#x27;
      ],
      &#x27;escape&#x27;: [
        &#x27;ëŒ€ì²´í–‰ë™: &quot;ì‰¬ì–´ìš”/ë„ì™€ì£¼ì„¸ìš”/ë°”ê¿”ì£¼ì„¸ìš”&quot; FCT&#x27;,
        &#x27;ì„ í–‰ì‚¬ê±´: ë‚œì´ë„ 80/20, ì‹œê° ì‘ì—…ë¶„ì„Â·íƒ€ì´ë¨¸&#x27;,
        &#x27;ê²°ê³¼ì „ëµ: ì ì ˆ ìš”ì²­ì—” ì§§ì€ íœ´ì‹Â·ë¶€ë¶„ ìˆ˜ì •, ë¬¸ì œí–‰ë™ì€ ê³¼ì œ ì™„ì„±ê³¼ ë¶„ë¦¬&#x27;,
        &#x27;í™˜ê²½: ì „í™˜ ì˜ˆê³ Â·í”„ë¦¬ë§¥ ë°°ì¹˜&#x27;,
        &#x27;ì¶”ê°€ì „ëµ: ì„ íƒê¶Œ ì œê³µ, ê³¼ì œ ì„¸ë¶„í™”&#x27;,
        &#x27;ë°ì´í„°: ê³¼ì œ ì™„ì„±ë¥  ë° íœ´ì‹ ìš”ì²­ ë¹ˆë„ ê¸°ë¡&#x27;
      ],
      &#x27;tangible&#x27;: [
        &#x27;ëŒ€ì²´í–‰ë™: &quot;ì£¼ì„¸ìš”/êµí™˜í• ë˜ìš”&quot; FCT + í† í°ê²½ì œ(ê°€ê²©í‘œ)&#x27;,
        &#x27;ì„ í–‰ì‚¬ê±´: ì„ í˜¸ë„ ì ê²€ ë£¨í‹´í™”&#x27;,
        &#x27;ê²°ê³¼ì „ëµ: ë¬¸ì œí–‰ë™ì—” ì ‘ê·¼ ì°¨ë‹¨, ì ì ˆ ìš”ì²­ì—” ì°¨ë³„ê°•í™”(DRA)&#x27;,
        &#x27;í™˜ê²½: ëŒ€ì²´ë¬¼ ì œê³µ(ëŒ€ê¸° ì‹œê°„ìš©)&#x27;,
        &#x27;ì¶”ê°€ì „ëµ: í™œë™ ìŠ¤ì¼€ì¤„ ì‹œê°í™”, íƒ€ì´ë¨¸ í™œìš©&#x27;,
        &#x27;ë°ì´í„°: ì„ í˜¸ë¬¼ ì ‘ê·¼ íšŸìˆ˜ ë° ëŒ€ê¸° ì‹œê°„ ì¸¡ì •&#x27;
      ],
      &#x27;sensory_seek&#x27;: [
        &#x27;ëŒ€ì²´í–‰ë™: ë™ì¼ ê¸°ëŠ¥ ê°ê°ëŒ€ì•ˆ(ì••ë°•/ìŠ¤í€´ì¦ˆ/ì† ìš´ë™)&#x27;,
        &#x27;ì„ í–‰ì‚¬ê±´: ê°ê° í—ˆìš© êµ¬ì—­Â·ì‹œê°„í‘œ&#x27;,
        &#x27;ê²°ê³¼ì „ëµ: ë¬¸ì œí–‰ë™ ê°ê°í”¼ë“œë°± ê°ì†Œ, ëŒ€ì²´ ê°ê°í–‰ë™ ê°•í™”&#x27;,
        &#x27;í™˜ê²½: ì €ìê·¹ ì½”ë„ˆ&#x27;,
        &#x27;ì¶”ê°€ì „ëµ: ê°ê° ë‹¤ì´ì–´íŠ¸ í”„ë¡œê·¸ë¨ êµ¬ì„±&#x27;,
        &#x27;ë°ì´í„°: ê°ê° ì¶”êµ¬ íŒ¨í„´ ABC ê¸°ë¡&#x27;
      ],
      &#x27;sensory_avoid&#x27;: [
        &#x27;ëŒ€ì²´í–‰ë™: &quot;ì‹«ì–´ìš”/ë©ˆì¶°ìš”/ì¡°ìš©íˆ&quot; FCT&#x27;,
        &#x27;ì„ í–‰ì‚¬ê±´: ì†ŒìŒÂ·ë¹›Â·ì ‘ì´‰ ì¡°ì •(í—¤ë“œí°/ì¡°ë„/ê±°ë¦¬)&#x27;,
        &#x27;ê²°ê³¼ì „ëµ: ì‹ í˜¸ ì‹œ ê³¼ì œ ì¶•ì†ŒÂ·íœ´ì‹, ë¬¸ì œí–‰ë™ì€ ìë™ ì¢…ê²° ë°©ì§€&#x27;,
        &#x27;í™˜ê²½: ì €ìê·¹ ë™ì„ Â·ì „í™˜ ì˜ˆê³ &#x27;,
        &#x27;ì¶”ê°€ì „ëµ: ì ì§„ì  ë‘”ê°í™” í”„ë¡œê·¸ë¨&#x27;,
        &#x27;ë°ì´í„°: í™˜ê²½ ìê·¹ ìˆ˜ì¤€ë³„ ë°˜ì‘ ê¸°ë¡&#x27;
      ],
      &#x27;peer&#x27;: [
        &#x27;ëŒ€ì²´í–‰ë™: ì ì ˆí•œ ë˜ë˜ ìƒí˜¸ì‘ìš© ìŠ¤í‚¬ êµìˆ˜&#x27;,
        &#x27;ì„ í–‰ì‚¬ê±´: êµ¬ì¡°í™”ëœ ë˜ë˜ í™œë™ ì œê³µ&#x27;,
        &#x27;ê²°ê³¼ì „ëµ: ê¸ì •ì  ìƒí˜¸ì‘ìš© ì¦‰ì‹œ ê°•í™”&#x27;,
        &#x27;í™˜ê²½: ì†Œê·¸ë£¹ í™œë™ ìš°ì„  ë°°ì¹˜&#x27;,
        &#x27;ì¶”ê°€ì „ëµ: ë˜ë˜ ì¤‘ì¬ì í™œìš©(peer mediation)&#x27;,
        &#x27;ë°ì´í„°: ìƒí˜¸ì‘ìš© ë¹ˆë„ ë° ì§ˆì  í‰ê°€&#x27;
      ],
      &#x27;unknown&#x27;: [
        &#x27;ê¸°ëŠ¥í‰ê°€ ìš°ì„ : ABC ê¸°ë¡, FAST, MAS ì‹¤ì‹œ&#x27;,
        &#x27;ë‹¨ë¬¸ FCT 4ì¢… ë³´ê¸‰: ë„ì™€ì£¼ì„¸ìš”/ì‰¬ì–´ìš”/ì£¼ì„¸ìš”/ê°™ì´í•´ìš”&#x27;,
        &#x27;í™˜ê²½ ì¬êµ¬ì¡°í™”: ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì¼ê³¼ êµ¬ì„±&#x27;,
        &#x27;ë‹¤ìš”ì†Œ ì¤‘ì¬: ì„ í–‰-í–‰ë™-ê²°ê³¼ ì „ëµ ë™ì‹œ ì ìš©&#x27;,
        &#x27;í˜‘ë ¥íŒ€ êµ¬ì„±: êµì‚¬-ì „ë¬¸ê°€-ê°€ì¡± í˜‘ì˜ì²´&#x27;,
        &#x27;ì§‘ì¤‘ ê´€ì°°: 2ì£¼ê°„ ìƒì„¸ ë°ì´í„° ìˆ˜ì§‘&#x27;
      ]
    };
    return recs[k] || recs[&#x27;unknown&#x27;];
  }

  function openFBA(student){
    const rows = data.filter(d=&gt; d.student===student);
    if(rows.length===0){ alert(&#x27;ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.&#x27;); return; }

    // Even with 1 data point, provide analysis
    const topBeh = summarize(rows, &#x27;behavior&#x27;);
    const funcList = summarize(rows, &#x27;func&#x27;);
    const topFunc = funcList.split(&#x27;,&#x27;)[0] ? funcList.split(&#x27;,&#x27;)[0].replace(/\(\d+\)/,&#x27;&#x27;).trim() : &#x27;ê¸°ëŠ¥ ë¶ˆëª…&#x27;;
    const topSet = summarize(rows, &#x27;setting&#x27;);
    const topDow = summarize(rows.map(r=&gt; ({dow: mapWeekday(r)})), &#x27;dow&#x27;);
    const topTime = summarize(rows, &#x27;time&#x27;);
    const topAnt = summarize(rows, &#x27;antecedent&#x27;);
    const topCon = summarize(rows, &#x27;consequence&#x27;);
    const meanInt = intensityMean(rows);
    const first = rows.map(r=&gt;r.dateKey).sort()[0];
    const last  = rows.map(r=&gt;r.dateKey).sort().slice(-1)[0];

    const recs = fctRecommendations(topFunc).map(x=&gt; `&lt;li&gt;${x}&lt;/li&gt;`).join(&#x27;&#x27;);

    // Additional analysis even for limited data
    const timePattern = analyzeTimePattern(rows);
    const escalationPattern = analyzeEscalation(rows);
    const contextualFactors = analyzeContext(rows);

    const body = `
      &lt;div class=&quot;grid grid-2&quot;&gt;
        &lt;div class=&quot;panel&quot;&gt;
          &lt;h4&gt;ê¸°ë³¸ ì •ë³´ (Basic Information)&lt;/h4&gt;
          &lt;table class=&quot;table&quot;&gt;
            &lt;tr&gt;&lt;th&gt;ë¶„ì„ ë²”ìœ„&lt;/th&gt;&lt;td&gt;${first} ~ ${last} (${rows.length}ê±´)&lt;/td&gt;&lt;/tr&gt;
            &lt;tr&gt;&lt;th&gt;ìƒìœ„ í–‰ë™&lt;/th&gt;&lt;td&gt;${topBeh}&lt;/td&gt;&lt;/tr&gt;
            &lt;tr&gt;&lt;th&gt;ê°•ë„ í‰ê· &lt;/th&gt;&lt;td&gt;${meanInt}&lt;/td&gt;&lt;/tr&gt;
            &lt;tr&gt;&lt;th&gt;ìƒìœ„ ê¸°ëŠ¥&lt;/th&gt;&lt;td&gt;${funcList}&lt;/td&gt;&lt;/tr&gt;
            &lt;tr&gt;&lt;th&gt;ìƒìœ„ ì¥ì†Œ&lt;/th&gt;&lt;td&gt;${topSet}&lt;/td&gt;&lt;/tr&gt;
            &lt;tr&gt;&lt;th&gt;ìš”ì¼/ì‹œê°„ëŒ€&lt;/th&gt;&lt;td&gt;${topDow} / ${topTime}&lt;/td&gt;&lt;/tr&gt;
            &lt;tr&gt;&lt;th&gt;ì£¼ìš” ì„ í–‰ì‚¬ê±´&lt;/th&gt;&lt;td&gt;${topAnt}&lt;/td&gt;&lt;/tr&gt;
            &lt;tr&gt;&lt;th&gt;ì£¼ìš” ê²°ê³¼&lt;/th&gt;&lt;td&gt;${topCon}&lt;/td&gt;&lt;/tr&gt;
          &lt;/table&gt;
        &lt;/div&gt;
        &lt;div class=&quot;panel&quot;&gt;
          &lt;h4&gt;í–‰ë™ íŒ¨í„´ ë¶„ì„ (Pattern Analysis)&lt;/h4&gt;
          &lt;div class=&quot;insight-box&quot;&gt;
            &lt;strong&gt;ì‹œê°„ íŒ¨í„´:&lt;/strong&gt; ${timePattern}&lt;br&gt;
            &lt;strong&gt;ê°•ë„ ë³€í™”:&lt;/strong&gt; ${escalationPattern}&lt;br&gt;
            &lt;strong&gt;ë§¥ë½ ìš”ì¸:&lt;/strong&gt; ${contextualFactors}
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      
      &lt;div class=&quot;panel&quot;&gt;
        &lt;h4&gt;ê¸°ëŠ¥ ê¸°ë°˜ í–‰ë™ ì¤‘ì¬ ê³„íš (BIP)&lt;/h4&gt;
        &lt;p&gt;&lt;strong&gt;${student}&lt;/strong&gt;ì˜ ë¬¸ì œí–‰ë™ì€ ì£¼ë¡œ &lt;u&gt;${topFunc}&lt;/u&gt; ê¸°ëŠ¥ìœ¼ë¡œ ë‚˜íƒ€ë‚¨ (í‰ê·  ê°•ë„: ${meanInt})&lt;/p&gt;
        &lt;h5&gt;í•µì‹¬ ì¤‘ì¬ ì „ëµ:&lt;/h5&gt;
        &lt;ul&gt;${recs}&lt;/ul&gt;
      &lt;/div&gt;

      &lt;div class=&quot;panel&quot;&gt;
        &lt;h4&gt;í–‰ë™ ì§€ì› ê³„íš êµ¬ì„±ìš”ì†Œ&lt;/h4&gt;
        &lt;div class=&quot;grid grid-2&quot;&gt;
          &lt;div&gt;
            &lt;h5&gt;ì˜ˆë°©ì  ì „ëµ (Antecedent Strategies)&lt;/h5&gt;
            &lt;ul class=&quot;small&quot;&gt;
              &lt;li&gt;í™˜ê²½ ìˆ˜ì •: ${getEnvironmentMod(topSet)}&lt;/li&gt;
              &lt;li&gt;ì¼ê³¼ ì¡°ì •: ${getScheduleMod(topTime)}&lt;/li&gt;
              &lt;li&gt;ì„ í–‰ìê·¹ í†µì œ: ${getAntecedentControl(topAnt)}&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/div&gt;
          &lt;div&gt;
            &lt;h5&gt;êµìˆ˜ì  ì „ëµ (Teaching Strategies)&lt;/h5&gt;
            &lt;ul class=&quot;small&quot;&gt;
              &lt;li&gt;ëŒ€ì²´ê¸°ìˆ : ${getReplacementSkill(topFunc)}&lt;/li&gt;
              &lt;li&gt;ëŒ€ì²˜ê¸°ìˆ : ${getCopingSkill(meanInt)}&lt;/li&gt;
              &lt;li&gt;ìê¸°ê´€ë¦¬: ${getSelfManagement(rows.length)}&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div class=&quot;panel&quot;&gt;
        &lt;h4&gt;ì§„í–‰ ëª¨ë‹ˆí„°ë§ ê³„íš (Progress Monitoring)&lt;/h4&gt;
        &lt;table class=&quot;table&quot;&gt;
          &lt;tr&gt;&lt;th&gt;ì¸¡ì • ì˜ì—­&lt;/th&gt;&lt;th&gt;ëª©í‘œ&lt;/th&gt;&lt;th&gt;ì¸¡ì • ë°©ë²•&lt;/th&gt;&lt;th&gt;ê²€í†  ì£¼ê¸°&lt;/th&gt;&lt;/tr&gt;
          &lt;tr&gt;&lt;td&gt;ë¬¸ì œí–‰ë™ ë¹ˆë„&lt;/td&gt;&lt;td&gt;ì£¼ë‹¹ ${Math.max(1, Math.floor(rows.length/10))}íšŒ ì´í•˜&lt;/td&gt;&lt;td&gt;ë¹ˆë„ ê¸°ë¡&lt;/td&gt;&lt;td&gt;ì£¼ê°„&lt;/td&gt;&lt;/tr&gt;
          &lt;tr&gt;&lt;td&gt;ëŒ€ì²´í–‰ë™ ì‚¬ìš©&lt;/td&gt;&lt;td&gt;ì¼ 3íšŒ ì´ìƒ&lt;/td&gt;&lt;td&gt;ì²´í¬ë¦¬ìŠ¤íŠ¸&lt;/td&gt;&lt;td&gt;ì¼ê°„&lt;/td&gt;&lt;/tr&gt;
          &lt;tr&gt;&lt;td&gt;ê°•ë„ ìˆ˜ì¤€&lt;/td&gt;&lt;td&gt;í‰ê·  2 ì´í•˜&lt;/td&gt;&lt;td&gt;5ì  ì²™ë„&lt;/td&gt;&lt;td&gt;ì£¼ê°„&lt;/td&gt;&lt;/tr&gt;
          &lt;tr&gt;&lt;td&gt;ê¸°ëŠ¥ì  ì˜ì‚¬ì†Œí†µ&lt;/td&gt;&lt;td&gt;80% ì„±ê³µë¥ &lt;/td&gt;&lt;td&gt;ë°˜ì‘ ê¸°ë¡&lt;/td&gt;&lt;td&gt;ì£¼ê°„&lt;/td&gt;&lt;/tr&gt;
        &lt;/table&gt;
      &lt;/div&gt;

      &lt;div class=&quot;panel&quot;&gt;
        &lt;h4&gt;ì‚¬ë¡€ ê¸°ë¡ (Incident Records)&lt;/h4&gt;
        &lt;table class=&quot;table&quot;&gt;
          &lt;thead&gt;&lt;tr&gt;&lt;th&gt;ë‚ ì§œ&lt;/th&gt;&lt;th&gt;ì‹œê°„&lt;/th&gt;&lt;th&gt;ì¥ì†Œ&lt;/th&gt;&lt;th&gt;ì„ í–‰&lt;/th&gt;&lt;th&gt;í–‰ë™&lt;/th&gt;&lt;th&gt;ê°•ë„&lt;/th&gt;&lt;th&gt;ê²°ê³¼&lt;/th&gt;&lt;th&gt;ê¸°ëŠ¥&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;
          &lt;tbody&gt;
            ${rows.slice(0,20).map(r=&gt; `&lt;tr&gt;
              &lt;td&gt;${r.dateKey}&lt;/td&gt;
              &lt;td&gt;${r.time}&lt;/td&gt;
              &lt;td&gt;${r.setting||&#x27;-&#x27;}&lt;/td&gt;
              &lt;td&gt;${r.antecedent||&#x27;-&#x27;}&lt;/td&gt;
              &lt;td&gt;${r.behavior}&lt;/td&gt;
              &lt;td&gt;${r.intensity}&lt;/td&gt;
              &lt;td&gt;${r.consequence||&#x27;-&#x27;}&lt;/td&gt;
              &lt;td&gt;${r.func||&#x27;-&#x27;}&lt;/td&gt;
            &lt;/tr&gt;`).join(&#x27;&#x27;)}
          &lt;/tbody&gt;
        &lt;/table&gt;
        &lt;p class=&quot;small&quot;&gt;* ìµœê·¼ 20ê±´ í‘œì‹œ. ì „ì²´ ${rows.length}ê±´ ì¤‘.&lt;/p&gt;
      &lt;/div&gt;

      &lt;div class=&quot;panel&quot;&gt;
        &lt;h4&gt;íŒ€ í˜‘ë ¥ ë° ìì› (Team Collaboration)&lt;/h4&gt;
        &lt;ul&gt;
          &lt;li&gt;ì£¼ ë‹´ë‹¹ì: ë‹´ì„êµì‚¬ / íŠ¹ìˆ˜êµì‚¬&lt;/li&gt;
          &lt;li&gt;ì§€ì›íŒ€: BCBA, í•™êµ ì‹¬ë¦¬ì‚¬, ë³´ì¡°êµì‚¬&lt;/li&gt;
          &lt;li&gt;ê°€ì¡± ì°¸ì—¬: ì£¼ê°„ ì†Œí†µ, ê°€ì • ì—°ê³„ ì „ëµ&lt;/li&gt;
          &lt;li&gt;í•„ìš” ìì›: ${getRequiredResources(topFunc)}&lt;/li&gt;
          &lt;li&gt;êµìœ¡ í•„ìš”: ${getTrainingNeeds(topFunc)}&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;

      &lt;div class=&quot;link-row&quot;&gt;
        &lt;a href=&quot;#&quot; onclick=&quot;window.print();return false;&quot;&gt;ğŸ–¨ï¸ ì¸ì‡„/PDF ì €ì¥&lt;/a&gt;
        &lt;a href=&quot;#&quot; onclick=&quot;exportFBA(&#x27;${student}&#x27;);return false;&quot;&gt;ğŸ“Š ë°ì´í„° ë‚´ë³´ë‚´ê¸°&lt;/a&gt;
      &lt;/div&gt;
    `;

    $(&#x27;modalTitle&#x27;).textContent = `${student} - ê¸°ëŠ¥ì  í–‰ë™ í‰ê°€(FBA) ìƒì„¸ ë³´ê³ ì„œ`;
    $(&#x27;modalBody&#x27;).innerHTML = body;
    showModal();
  }

  function analyzeTimePattern(rows) {
    const times = rows.map(r =&gt; parseInt(r.time) || 0);
    const morning = times.filter(t =&gt; t &gt;= 9 &amp;&amp; t &lt; 12).length;
    const afternoon = times.filter(t =&gt; t &gt;= 12 &amp;&amp; t &lt; 17).length;
    if (morning &gt; afternoon * 1.5) return &#x27;ì˜¤ì „ ì§‘ì¤‘í˜• (ì „í™˜ ì‹œê°„ ì£¼ì˜)&#x27;;
    if (afternoon &gt; morning * 1.5) return &#x27;ì˜¤í›„ ì§‘ì¤‘í˜• (í”¼ë¡œë„ ê´€ë¦¬ í•„ìš”)&#x27;;
    return &#x27;ì „ì¼ ë¶„ì‚°í˜• (ì¼ê´€ëœ ì§€ì› í•„ìš”)&#x27;;
  }

  function analyzeEscalation(rows) {
    if (rows.length &lt; 2) return &#x27;ë°ì´í„° ë¶€ì¡± (ì¶”ê°€ ê´€ì°° í•„ìš”)&#x27;;
    const recent = rows.slice(-5);
    const older = rows.slice(0, -5);
    const recentAvg = intensityMean(recent);
    const olderAvg = intensityMean(older);
    if (recentAvg &gt; olderAvg * 1.2) return &#x27;ìƒìŠ¹ ê²½í–¥ (ì¦‰ì‹œ ê°œì… í•„ìš”)&#x27;;
    if (recentAvg &lt; olderAvg * 0.8) return &#x27;ê°ì†Œ ê²½í–¥ (ì¤‘ì¬ íš¨ê³¼ ê¸ì •ì )&#x27;;
    return &#x27;ì•ˆì •ì  (í˜„ ì „ëµ ìœ ì§€)&#x27;;
  }

  function analyzeContext(rows) {
    const settings = rows.map(r =&gt; r.setting).filter(Boolean);
    const uniqueSettings = new Set(settings).size;
    if (uniqueSettings === 1) return &#x27;íŠ¹ì • í™˜ê²½ ì œí•œì  (í™˜ê²½ ìˆ˜ì • ìš°ì„ )&#x27;;
    if (uniqueSettings &gt;= 3) return &#x27;ë‹¤ì–‘í•œ í™˜ê²½ ë°œìƒ (ì¼ë°˜í™” ì „ëµ í•„ìš”)&#x27;;
    return &#x27;ì œí•œì  í™˜ê²½ (êµ¬ì¡°í™” ê°•í™”)&#x27;;
  }

  function getEnvironmentMod(setting) {
    const mods = {
      &#x27;êµì‹¤&#x27;: &#x27;ì¢Œì„ ë°°ì¹˜ ì¡°ì •, ìê·¹ ê°ì†Œ êµ¬ì—­ ì„¤ì •&#x27;,
      &#x27;ë³µë„&#x27;: &#x27;ì „í™˜ ì‹œê°„ êµ¬ì¡°í™”, ì‹œê°ì  ë‹¨ì„œ ì œê³µ&#x27;,
      &#x27;ì²´ìœ¡ê´€&#x27;: &#x27;í™œë™ ìˆ˜ì¤€ ì¡°ì ˆ, íœ´ì‹ ê³µê°„ í™•ë³´&#x27;,
      &#x27;ê¸‰ì‹ì‹¤&#x27;: &#x27;ì†ŒìŒ ê´€ë¦¬, ëŒ€ê¸° ì‹œê°„ ë‹¨ì¶•&#x27;,
      &#x27;íŠ¹ë³„ì‹¤&#x27;: &#x27;ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë£¨í‹´ í™•ë¦½&#x27;,
      &#x27;í™”ì¥ì‹¤&#x27;: &#x27;í”„ë¼ì´ë²„ì‹œ ë³´ì¥, ì‹œê°„ ì œí•œ ì„¤ì •&#x27;,
      &#x27;ìš´ë™ì¥&#x27;: &#x27;êµ¬ì—­ ì„¤ì •, ê°ë… ê°•í™”&#x27;,
      &#x27;ë„ì„œê´€&#x27;: &#x27;ì¡°ìš©í•œ êµ¬ì—­ í™œìš©, ê°œë³„ ê³µê°„ ì œê³µ&#x27;
    };
    return mods[setting] || &#x27;í™˜ê²½ í‰ê°€ í›„ ë§ì¶¤ ìˆ˜ì •&#x27;;
  }

  function getScheduleMod(time) {
    const hour = parseInt(time) || 10;
    if (hour &lt; 10) return &#x27;ì•„ì¹¨ ë£¨í‹´ ê°•í™”, ì ì§„ì  í™œë™ ì‹œì‘&#x27;;
    if (hour &lt; 12) return &#x27;ì¤‘ê°„ íœ´ì‹ ì œê³µ, ì§‘ì¤‘ ì‹œê°„ ì¡°ì ˆ&#x27;;
    if (hour &lt; 14) return &#x27;ì ì‹¬ ì „í›„ ì „í™˜ ì§€ì›&#x27;;
    if (hour &lt; 16) return &#x27;ì˜¤í›„ í”¼ë¡œ ê´€ë¦¬, í™œë™ ìˆ˜ì¤€ ì¡°ì ˆ&#x27;;
    return &#x27;í•˜ë£¨ ì¢…ì¼ ì¼ê´€ëœ êµ¬ì¡° ì œê³µ&#x27;;
  }

  function getAntecedentControl(antecedent) {
    const controls = {
      &#x27;ê³¼ì œ ì œì‹œ&#x27;: &#x27;ê³¼ì œ ì„¸ë¶„í™”, ì„ íƒê¶Œ ì œê³µ, ë‚œì´ë„ ì¡°ì ˆ&#x27;,
      &#x27;ì „í™˜ ì‹œê°„&#x27;: &#x27;ì‹œê°ì  íƒ€ì´ë¨¸, ì „í™˜ ì˜ˆê³ , ì „í™˜ ë£¨í‹´&#x27;,
      &#x27;ë˜ë˜ ì ‘ê·¼&#x27;: &#x27;ì‚¬íšŒì  ê¸°ìˆ  ì‚¬ì „ êµìˆ˜, ì¤‘ì¬ì ë°°ì¹˜&#x27;,
      &#x27;ì§€ì‹œ ì œê³µ&#x27;: &#x27;ê¸ì •ì  ì–¸ì–´ ì‚¬ìš©, ëª…í™•í•œ ê¸°ëŒ€ ì„¤ì •&#x27;,
      &#x27;ì„ í˜¸ í™œë™ ì¢…ë£Œ&#x27;: &#x27;ì¢…ë£Œ ì˜ˆê³ , ë‹¤ìŒ í™œë™ ì˜ˆì¸¡&#x27;,
      &#x27;ëŒ€ê¸° ì‹œê°„&#x27;: &#x27;ëŒ€ê¸° í™œë™ ì œê³µ, ì‹œê°ì  ìŠ¤ì¼€ì¤„&#x27;
    };
    return controls[antecedent] || &#x27;ì„ í–‰ì‚¬ê±´ ë¶„ì„ í›„ ê°œë³„í™”&#x27;;
  }

  function getReplacementSkill(func) {
    const skills = {
      &#x27;ì„±ì¸ì˜ ê´€ì‹¬&#x27;: &#x27;ì ì ˆí•œ ê´€ì‹¬ ìš”ì²­ ë°©ë²•&#x27;,
      &#x27;ê³¼ì œ/ìš”êµ¬ íšŒí”¼&#x27;: &#x27;íœ´ì‹ ìš”ì²­, ë„ì›€ ìš”ì²­ ê¸°ìˆ &#x27;,
      &#x27;ìœ í˜•ë¬¼/í™œë™ íšë“&#x27;: &#x27;ìš”ì²­í•˜ê¸°, ì°¨ë¡€ ê¸°ë‹¤ë¦¬ê¸°&#x27;,
      &#x27;ê°ê° ì¶”êµ¬&#x27;: &#x27;ì ì ˆí•œ ê°ê° í™œë™ ì„ íƒ&#x27;,
      &#x27;ê°ê° íšŒí”¼&#x27;: &#x27;ë¶ˆí¸í•¨ í‘œí˜„í•˜ê¸°&#x27;,
      &#x27;ë˜ë˜ ê´€ì‹¬&#x27;: &#x27;ë˜ë˜ì™€ ìƒí˜¸ì‘ìš© ì‹œì‘í•˜ê¸°&#x27;
    };
    return skills[func] || &#x27;ê¸°ëŠ¥ì  ì˜ì‚¬ì†Œí†µ í›ˆë ¨&#x27;;
  }

  function getCopingSkill(intensity) {
    if (intensity &gt; 3) return &#x27;ì‹¬í˜¸í¡, ì´ì™„ ê¸°ë²•, ì•ˆì „ ê³µê°„ í™œìš©&#x27;;
    if (intensity &gt; 2) return &#x27;ìê¸° ì§„ì • ì „ëµ, íœ´ì‹ ìš”ì²­&#x27;;
    return &#x27;ê°ì • ì¸ì‹, ê¸°ë³¸ ëŒ€ì²˜ ì „ëµ&#x27;;
  }

  function getSelfManagement(frequency) {
    if (frequency &gt; 10) return &#x27;ìê¸° ëª¨ë‹ˆí„°ë§ ì²´ê³„ ë„ì…&#x27;;
    if (frequency &gt; 5) return &#x27;í† í° ê²½ì œ í™œìš©&#x27;;
    return &#x27;ì‹œê°ì  ì§€ì› ë„êµ¬ í™œìš©&#x27;;
  }

  function getRequiredResources(func) {
    const resources = {
      &#x27;ì„±ì¸ì˜ ê´€ì‹¬&#x27;: &#x27;ì‹œê°ì  ì‹ í˜¸ ì¹´ë“œ, íƒ€ì´ë¨¸, ê°•í™” ìŠ¤ì¼€ì¤„í‘œ&#x27;,
      &#x27;ê³¼ì œ/ìš”êµ¬ íšŒí”¼&#x27;: &#x27;ê³¼ì œ ë¶„ì„í‘œ, ì„ íƒ ë³´ë“œ, íœ´ì‹ ì¹´ë“œ&#x27;,
      &#x27;ìœ í˜•ë¬¼/í™œë™ íšë“&#x27;: &#x27;í† í° ë³´ë“œ, ì„ í˜¸ë„ í‰ê°€ ë„êµ¬, íƒ€ì´ë¨¸&#x27;,
      &#x27;ê°ê° ì¶”êµ¬&#x27;: &#x27;ê°ê° ë„êµ¬ í‚¤íŠ¸, ê°ê° ìŠ¤ì¼€ì¤„&#x27;,
      &#x27;ê°ê° íšŒí”¼&#x27;: &#x27;ì†ŒìŒ ì°¨ë‹¨ í—¤ë“œí°, ì¡°ë„ ì¡°ì ˆ ë„êµ¬&#x27;,
      &#x27;ë˜ë˜ ê´€ì‹¬&#x27;: &#x27;ì‚¬íšŒì  ì´ì•¼ê¸°, ë˜ë˜ í™œë™ ì¹´ë“œ&#x27;
    };
    return resources[func] || &#x27;ê¸°ë³¸ PBS ë„êµ¬ ì„¸íŠ¸&#x27;;
  }

  function getTrainingNeeds(func) {
    const training = {
      &#x27;ì„±ì¸ì˜ ê´€ì‹¬&#x27;: &#x27;DRA/DRO ì ˆì°¨, ê³„íšì  ë¬´ì‹œ ê¸°ë²•&#x27;,
      &#x27;ê³¼ì œ/ìš”êµ¬ íšŒí”¼&#x27;: &#x27;FCT ì‹¤í–‰, ê³¼ì œ ìˆ˜ì • ì „ëµ&#x27;,
      &#x27;ìœ í˜•ë¬¼/í™œë™ íšë“&#x27;: &#x27;í† í° ê²½ì œ ìš´ì˜, ì°¨ë³„ê°•í™”&#x27;,
      &#x27;ê°ê° ì¶”êµ¬&#x27;: &#x27;ê°ê° í†µí•© ì´í•´, ëŒ€ì²´ ê°ê° í™œë™&#x27;,
      &#x27;ê°ê° íšŒí”¼&#x27;: &#x27;í™˜ê²½ ìˆ˜ì •, ì ì§„ì  ë‘”ê°í™”&#x27;,
      &#x27;ë˜ë˜ ê´€ì‹¬&#x27;: &#x27;ë˜ë˜ ì¤‘ì¬ ì „ëµ, ì‚¬íšŒì  ê¸°ìˆ  êµìˆ˜&#x27;
    };
    return training[func] || &#x27;PBS ê¸°ë³¸ êµìœ¡&#x27;;
  }

  function renderTier1Recs(){
    if(data.length===0){ $(&#x27;tier1Recs&#x27;).innerHTML=&#x27;ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.&#x27;; return; }
    const topDow = countBy(data, d=&gt; mapWeekday(d));
    const peakDow = (topDow.labels[topDow.counts.indexOf(Math.max(...topDow.counts))]||&#x27;ì›”&#x27;);
    const topTime = countBy(data, d=&gt; d.time);
    const peakTime = (topTime.labels[topTime.counts.indexOf(Math.max(...topTime.counts))]||&#x27;10ì‹œ&#x27;);
    const topSetting = countBy(data, d=&gt; d.setting);
    const peakSetting = (topSetting.labels[topSetting.counts.indexOf(Math.max(...topSetting.counts))]||&#x27;êµì‹¤&#x27;);

    $(&#x27;tier1Recs&#x27;).innerHTML = `
      &lt;h4&gt;í•µì‹¬ ìœ„í—˜ ì‹œê°„ëŒ€: ${peakDow}ìš”ì¼ ${peakTime} ${peakSetting}&lt;/h4&gt;
      &lt;ul&gt;
        &lt;li&gt;&lt;strong&gt;í™˜ê²½ êµ¬ì¡°í™”:&lt;/strong&gt; TEACCH ì›ë¦¬ ì ìš© - ì‹œê°ì  ìŠ¤ì¼€ì¤„, ì‘ì—… ì‹œìŠ¤í…œ, ë¬¼ë¦¬ì  êµ¬ì¡°í™”&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;ê¸°ëŒ€í–‰ë™ êµìˆ˜:&lt;/strong&gt; BST(í–‰ë™ê¸°ìˆ í›ˆë ¨) - ì„¤ëª…â†’ì‹œë²”â†’ì—°ìŠµâ†’í”¼ë“œë°± ì£¼ 3íšŒ&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;ì˜ˆë°©ì  ì „ëµ:&lt;/strong&gt; ê³ ìœ„í—˜ ì‹œê°„ëŒ€ ì‚¬ì „ ì¤€ë¹„(priming), ì „í™˜ ì˜ˆê³ , ì„ íƒ ê¸°íšŒ ì œê³µ&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;ê¸ì •ì  í–‰ë™ì§€ì›:&lt;/strong&gt; 5:1 ê¸ì •ì  ìƒí˜¸ì‘ìš© ë¹„ìœ¨, í† í° ê²½ì œ, ê·¸ë£¹ ê°•í™”&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;ìœ„ê¸° ëŒ€ì‘ ì²´ê³„:&lt;/strong&gt; 3ë‹¨ê³„ ëŒ€ì‘(ì˜ˆë°©-êµìˆ˜-ëŒ€ì‘), ì•ˆì „ í”„ë¡œí† ì½œ, íŒ€ ì—­í•  ë¶„ë‹´&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì •:&lt;/strong&gt; ì¼ì¼ ì²´í¬ì¸, ì£¼ê°„ íŒ€ ë¯¸íŒ…, ì›”ê°„ ê²€í† &lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;ê°€ì • ì—°ê³„:&lt;/strong&gt; ì¼ê´€ëœ ì „ëµ ì ìš©, ê°€ì •ìš© ì‹œê° ì§€ì›, ì£¼ê°„ ì†Œí†µ&lt;/li&gt;
        &lt;li&gt;&lt;strong&gt;êµì§ì› ì—­ëŸ‰ ê°•í™”:&lt;/strong&gt; PBS ê¸°ë³¸ êµìœ¡, ê¸°ëŠ¥í‰ê°€ ì´í•´, ì¤‘ì¬ ì¶©ì‹¤ë„ ì ê²€&lt;/li&gt;
      &lt;/ul&gt;
    `;
  }

  function renderPreventiveStrategies() {
    const strategies = `
      &lt;h4&gt;1. ì„ í–‰ì‚¬ê±´ ê¸°ë°˜ ì˜ˆë°© (Antecedent-Based Prevention)&lt;/h4&gt;
      &lt;ul&gt;
        &lt;li&gt;í™˜ê²½ ì¬êµ¬ì„±: ìê·¹ í†µì œ, ë¬¼ë¦¬ì  ë°°ì¹˜ ìµœì í™”&lt;/li&gt;
        &lt;li&gt;ì¼ê³¼ ìˆ˜ì •: ê³ ì„ í˜¸-ì €ì„ í˜¸ í™œë™ êµëŒ€ ë°°ì¹˜&lt;/li&gt;
        &lt;li&gt;ì„ íƒ ì œê³µ: ê³¼ì œ, ìˆœì„œ, ë„êµ¬ ì„ íƒê¶Œ&lt;/li&gt;
        &lt;li&gt;ì‚¬ì „ ì¤€ë¹„: 5ë¶„ ì „ ì˜ˆê³ , ì‹œê°ì  ë‹¨ì„œ&lt;/li&gt;
      &lt;/ul&gt;
      
      &lt;h4&gt;2. ì„¤ì • ì‚¬ê±´ ìˆ˜ì • (Setting Event Modifications)&lt;/h4&gt;
      &lt;ul&gt;
        &lt;li&gt;ìƒë¦¬ì  ìš”ì¸: ìˆ˜ë©´, ì˜ì–‘, ì•½ë¬¼ ê´€ë¦¬&lt;/li&gt;
        &lt;li&gt;ì •ì„œì  ìš”ì¸: ì•„ì¹¨ ì²´í¬ì¸, ê°ì • ì˜¨ë„ê³„&lt;/li&gt;
        &lt;li&gt;ì‚¬íšŒì  ìš”ì¸: ë˜ë˜ ê´€ê³„ ëª¨ë‹ˆí„°ë§&lt;/li&gt;
        &lt;li&gt;í™˜ê²½ì  ìš”ì¸: ì†ŒìŒ, ì¡°ëª…, ì˜¨ë„ ì¡°ì ˆ&lt;/li&gt;
      &lt;/ul&gt;
      
      &lt;h4&gt;3. í–‰ë™ ëª¨ë©˜í…€ ì „ëµ (Behavioral Momentum)&lt;/h4&gt;
      &lt;ul&gt;
        &lt;li&gt;ê³ í™•ë¥  ìš”êµ¬ ì‹œí€€ìŠ¤ (3-5ê°œ)&lt;/li&gt;
        &lt;li&gt;ì„ í˜¸ í™œë™ìœ¼ë¡œ ì‹œì‘&lt;/li&gt;
        &lt;li&gt;ì„±ê³µ ê²½í—˜ ëˆ„ì &lt;/li&gt;
        &lt;li&gt;ì ì§„ì  ë‚œì´ë„ ìƒìŠ¹&lt;/li&gt;
      &lt;/ul&gt;
    `;
    $(&#x27;preventiveStrategies&#x27;).innerHTML = strategies;
  }

  function renderEnvironmentRecs() {
    const recs = `
      &lt;h4&gt;1. ë¬¼ë¦¬ì  í™˜ê²½ êµ¬ì¡°í™”&lt;/h4&gt;
      &lt;ul&gt;
        &lt;li&gt;ëª…í™•í•œ ê²½ê³„ ì„¤ì •: í™œë™ ì˜ì—­ êµ¬ë¶„&lt;/li&gt;
        &lt;li&gt;ì‹œê°ì  ë‹¨ì„œ: ë¼ë²¨, ìƒ‰ìƒ ì½”ë”©, ë™ì„  í‘œì‹œ&lt;/li&gt;
        &lt;li&gt;ê°ê° ì¹œí™”ì  ê³µê°„: ì¡°ìš©í•œ êµ¬ì—­, íœ´ì‹ ê³µê°„&lt;/li&gt;
        &lt;li&gt;ì ‘ê·¼ì„±: í•„ìš” ìë£Œ ì‰½ê²Œ ì ‘ê·¼ ê°€ëŠ¥&lt;/li&gt;
      &lt;/ul&gt;
      
      &lt;h4&gt;2. ì‹œê°„ì  í™˜ê²½ êµ¬ì¡°í™”&lt;/h4&gt;
      &lt;ul&gt;
        &lt;li&gt;ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì¼ê³¼: ì¼ê´€ëœ ë£¨í‹´&lt;/li&gt;
        &lt;li&gt;ì‹œê°ì  ìŠ¤ì¼€ì¤„: ê°œë³„/í•™ê¸‰ ìŠ¤ì¼€ì¤„&lt;/li&gt;
        &lt;li&gt;ì „í™˜ ì§€ì›: íƒ€ì´ë¨¸, ì „í™˜ ì‹ í˜¸&lt;/li&gt;
        &lt;li&gt;ìœ ì—°í•œ ì†ë„: ê°œë³„ ì†ë„ í—ˆìš©&lt;/li&gt;
      &lt;/ul&gt;
      
      &lt;h4&gt;3. ì‚¬íšŒì  í™˜ê²½ ìµœì í™”&lt;/h4&gt;
      &lt;ul&gt;
        &lt;li&gt;ë˜ë˜ ì§€ì› ì²´ê³„: ë²„ë”” ì‹œìŠ¤í…œ&lt;/li&gt;
        &lt;li&gt;ì„±ì¸ ì§€ì› ë¹„ìœ¨: í•„ìš”ì‹œ 1:1 ì§€ì›&lt;/li&gt;
        &lt;li&gt;ê¸ì •ì  í•™ê¸‰ ë¬¸í™”: í¬ìš©, ì§€ì§€&lt;/li&gt;
        &lt;li&gt;ëª…í™•í•œ ê¸°ëŒ€: í•™ê¸‰ ê·œì¹™ ì‹œê°í™”&lt;/li&gt;
      &lt;/ul&gt;
    `;
    $(&#x27;environmentRecs&#x27;).innerHTML = recs;
  }

  function renderTier2GroupRecs() {
    const recs = `
      &lt;h4&gt;Tier 2 ì†Œê·¸ë£¹ ì¤‘ì¬ í”„ë¡œê·¸ë¨&lt;/h4&gt;
      
      &lt;div class=&quot;insight-box&quot;&gt;
        &lt;strong&gt;Check-In/Check-Out (CICO) í”„ë¡œê·¸ë¨&lt;/strong&gt;
        &lt;ul&gt;
          &lt;li&gt;ì•„ì¹¨ ì²´í¬ì¸: ëª©í‘œ ì„¤ì •, ì¤€ë¹„ë„ ì ê²€&lt;/li&gt;
          &lt;li&gt;ìˆ˜ì—…ë³„ í”¼ë“œë°±: ì ìˆ˜ ì¹´ë“œ í™œìš©&lt;/li&gt;
          &lt;li&gt;ì˜¤í›„ ì²´í¬ì•„ì›ƒ: ëª©í‘œ ë‹¬ì„± ê²€í† &lt;/li&gt;
          &lt;li&gt;ê°€ì • ì—°ê³„: ì¼ì¼ ë³´ê³ ì„œ&lt;/li&gt;
          &lt;li&gt;ì£¼ê°„ ë°ì´í„° ê²€í† : ì§„ì „ë„ ëª¨ë‹ˆí„°ë§&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
      
      &lt;div class=&quot;insight-box&quot;&gt;
        &lt;strong&gt;ì‚¬íšŒì  ê¸°ìˆ  ê·¸ë£¹ (Social Skills Group)&lt;/strong&gt;
        &lt;ul&gt;
          &lt;li&gt;ì£¼ 2íšŒ 30ë¶„ ì„¸ì…˜&lt;/li&gt;
          &lt;li&gt;6-8ëª… ì†Œê·¸ë£¹ êµ¬ì„±&lt;/li&gt;
          &lt;li&gt;ì—­í• ê·¹, ëª¨ë¸ë§, í”¼ë“œë°±&lt;/li&gt;
          &lt;li&gt;ë˜ë˜ ìƒí˜¸ì‘ìš© ì—°ìŠµ&lt;/li&gt;
          &lt;li&gt;ì¼ë°˜í™” ì „ëµ: êµì‹¤ ì ìš©&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
      
      &lt;div class=&quot;insight-box&quot;&gt;
        &lt;strong&gt;ìê¸°ê´€ë¦¬ í›ˆë ¨ (Self-Management)&lt;/strong&gt;
        &lt;ul&gt;
          &lt;li&gt;ìê¸° ëª¨ë‹ˆí„°ë§: í–‰ë™ ê¸°ë¡&lt;/li&gt;
          &lt;li&gt;ëª©í‘œ ì„¤ì •: ë‹¬ì„± ê°€ëŠ¥í•œ ë‹¨ê³„ë³„ ëª©í‘œ&lt;/li&gt;
          &lt;li&gt;ìê¸° í‰ê°€: ì²´í¬ë¦¬ìŠ¤íŠ¸&lt;/li&gt;
          &lt;li&gt;ìê¸° ê°•í™”: í† í°/í¬ì¸íŠ¸&lt;/li&gt;
          &lt;li&gt;ì ì§„ì  ë…ë¦½ì„± ì¦ê°€&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
      
      &lt;h4&gt;Tier 2 ì§„í–‰ ëª¨ë‹ˆí„°ë§&lt;/h4&gt;
      &lt;ul&gt;
        &lt;li&gt;ì£¼ê°„ ë°ì´í„° ê²€í†  íšŒì˜&lt;/li&gt;
        &lt;li&gt;ì›”ê°„ ê°€ì¡± ë©´ë‹´&lt;/li&gt;
        &lt;li&gt;6ì£¼ í›„ íš¨ê³¼ì„± í‰ê°€&lt;/li&gt;
        &lt;li&gt;í•„ìš”ì‹œ Tier 3 ì˜ë¢° ê²€í† &lt;/li&gt;
      &lt;/ul&gt;
    `;
    $(&#x27;tier2GroupRecs&#x27;).innerHTML = recs;
  }

  function renderTier3IndividualRecs() {
    const recs = `
      &lt;h4&gt;Tier 3 ê°œë³„í™” ì§‘ì¤‘ ì§€ì›&lt;/h4&gt;
      
      &lt;div class=&quot;insight-box&quot;&gt;
        &lt;strong&gt;í¬ê´„ì  ê¸°ëŠ¥í‰ê°€ (Comprehensive FBA)&lt;/strong&gt;
        &lt;ul&gt;
          &lt;li&gt;ì§ì ‘ ê´€ì°°: ABC ì—°ì† ê¸°ë¡&lt;/li&gt;
          &lt;li&gt;ê°„ì ‘ í‰ê°€: FAST, MAS, QABF&lt;/li&gt;
          &lt;li&gt;ê¸°ëŠ¥ ë¶„ì„: ì‹¤í—˜ì  ì¡°ì‘ (í•„ìš”ì‹œ)&lt;/li&gt;
          &lt;li&gt;ìƒíƒœí•™ì  í‰ê°€: ì „ì²´ í™˜ê²½ ë¶„ì„&lt;/li&gt;
          &lt;li&gt;íŒ€ ê¸°ë°˜ ê°€ì„¤ ê°œë°œ&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
      
      &lt;div class=&quot;insight-box&quot;&gt;
        &lt;strong&gt;ê°œë³„í™” í–‰ë™ì§€ì›ê³„íš (Individualized BIP)&lt;/strong&gt;
        &lt;ul&gt;
          &lt;li&gt;ê¸°ëŠ¥ ê¸°ë°˜ ì¤‘ì¬ ì„¤ê³„&lt;/li&gt;
          &lt;li&gt;ë‹¤ìš”ì†Œ ì¤‘ì¬: ì„ í–‰-êµìˆ˜-ê²°ê³¼&lt;/li&gt;
          &lt;li&gt;ìœ„ê¸° ê´€ë¦¬ ê³„íš í¬í•¨&lt;/li&gt;
          &lt;li&gt;ì¤‘ì¬ ì¶©ì‹¤ë„ ì²´í¬ë¦¬ìŠ¤íŠ¸&lt;/li&gt;
          &lt;li&gt;ì¼ì¼ ë°ì´í„° ìˆ˜ì§‘ ì²´ê³„&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
      
      &lt;div class=&quot;insight-box&quot;&gt;
        &lt;strong&gt;ì§‘ì¤‘ ê°œë³„ êµìˆ˜ (Intensive Instruction)&lt;/strong&gt;
        &lt;ul&gt;
          &lt;li&gt;1:1 ë˜ëŠ” 1:2 ë¹„ìœ¨&lt;/li&gt;
          &lt;li&gt;ì¼ì¼ 30-60ë¶„ ì§‘ì¤‘ ì„¸ì…˜&lt;/li&gt;
          &lt;li&gt;ëŒ€ì²´ê¸°ìˆ  ì§‘ì¤‘ í›ˆë ¨&lt;/li&gt;
          &lt;li&gt;ì¦‰ê°ì  í”¼ë“œë°±ê³¼ ê°•í™”&lt;/li&gt;
          &lt;li&gt;ì²´ê³„ì  ì¼ë°˜í™” ê³„íš&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
      
      &lt;div class=&quot;insight-box&quot;&gt;
        &lt;strong&gt;Wraparound ì„œë¹„ìŠ¤&lt;/strong&gt;
        &lt;ul&gt;
          &lt;li&gt;ë‹¤í•™ì œ íŒ€ êµ¬ì„±: êµìœ¡, í–‰ë™, ì˜ë£Œ&lt;/li&gt;
          &lt;li&gt;ê°€ì¡± ì¤‘ì‹¬ ê³„íš&lt;/li&gt;
          &lt;li&gt;ì§€ì—­ì‚¬íšŒ ìì› ì—°ê³„&lt;/li&gt;
          &lt;li&gt;24ì‹œê°„ ì§€ì› ì²´ê³„&lt;/li&gt;
          &lt;li&gt;ì „í™˜ ê³„íš ìˆ˜ë¦½&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
      
      &lt;h4&gt;Tier 3 ì„±ê³¼ í‰ê°€&lt;/h4&gt;
      &lt;ul&gt;
        &lt;li&gt;ì¼ì¼ ì§„ì „ë„ ëª¨ë‹ˆí„°ë§&lt;/li&gt;
        &lt;li&gt;ì£¼ê°„ íŒ€ ê²€í†  íšŒì˜&lt;/li&gt;
        &lt;li&gt;ì›”ê°„ BIP ìˆ˜ì • ê²€í† &lt;/li&gt;
        &lt;li&gt;ë¶„ê¸°ë³„ ì¢…í•© í‰ê°€&lt;/li&gt;
        &lt;li&gt;ë‹¨ê³„ì  ì§€ì› ê°ì†Œ ê³„íš&lt;/li&gt;
      &lt;/ul&gt;
    `;
    $(&#x27;tier3IndividualRecs&#x27;).innerHTML = recs;
  }

  function renderPatternAnalysis() {
    if(data.length === 0) {
      $(&#x27;patternAnalysis&#x27;).innerHTML = &#x27;&lt;p&gt;ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.&lt;/p&gt;&#x27;;
      return;
    }
    
    // Analyze patterns
    const behaviorPairs = analyzeBehaviorPairs();
    const temporalPatterns = analyzeTemporalPatterns();
    const functionPatterns = analyzeFunctionPatterns();
    
    const analysis = `
      &lt;h4&gt;1. í–‰ë™ ì—°ì‡„ ë¶„ì„ (Behavior Chain Analysis)&lt;/h4&gt;
      &lt;div class=&quot;insight-box&quot;&gt;
        ${behaviorPairs}
      &lt;/div&gt;
      
      &lt;h4&gt;2. ì‹œê°„ì  íŒ¨í„´ (Temporal Patterns)&lt;/h4&gt;
      &lt;div class=&quot;insight-box&quot;&gt;
        ${temporalPatterns}
      &lt;/div&gt;
      
      &lt;h4&gt;3. ê¸°ëŠ¥ì  íŒ¨í„´ (Functional Patterns)&lt;/h4&gt;
      &lt;div class=&quot;insight-box&quot;&gt;
        ${functionPatterns}
      &lt;/div&gt;
      
      &lt;h4&gt;4. ì˜ˆì¸¡ ì§€í‘œ (Predictive Indicators)&lt;/h4&gt;
      &lt;ul&gt;
        &lt;li&gt;ê³ ìœ„í—˜ ì¡°í•©: ${getHighRiskCombination()}&lt;/li&gt;
        &lt;li&gt;ë³´í˜¸ ìš”ì¸: ${getProtectiveFactors()}&lt;/li&gt;
        &lt;li&gt;ì¡°ê¸° ê²½ê³  ì‹ í˜¸: ${getEarlyWarnings()}&lt;/li&gt;
      &lt;/ul&gt;
    `;
    $(&#x27;patternAnalysis&#x27;).innerHTML = analysis;
  }

  function analyzeBehaviorPairs() {
    const pairs = {};
    data.forEach((d, i) =&gt; {
      if (i &gt; 0 &amp;&amp; data[i-1].student === d.student) {
        const pair = `${data[i-1].behavior} â†’ ${d.behavior}`;
        pairs[pair] = (pairs[pair] || 0) + 1;
      }
    });
    
    const sorted = Object.entries(pairs).sort((a,b) =&gt; b[1] - a[1]).slice(0, 3);
    if (sorted.length === 0) return &#x27;ì—°ì† í–‰ë™ íŒ¨í„´ ë°ì´í„° ë¶€ì¡±&#x27;;
    
    return sorted.map(([pair, count]) =&gt; 
      `&lt;li&gt;${pair}: ${count}íšŒ (ì˜ˆë°© í¬ì¸íŠ¸ ì‹ë³„)&lt;/li&gt;`
    ).join(&#x27;&#x27;);
  }

  function analyzeTemporalPatterns() {
    const hourly = {};
    data.forEach(d =&gt; {
      const hour = parseInt(d.time) || 0;
      hourly[hour] = (hourly[hour] || 0) + 1;
    });
    
    const peak = Object.entries(hourly).sort((a,b) =&gt; b[1] - a[1])[0];
    if (!peak) return &#x27;ì‹œê°„ íŒ¨í„´ ë¶„ì„ ë¶ˆê°€&#x27;;
    
    return `
      &lt;li&gt;ìµœë‹¤ ë°œìƒ ì‹œê°„: ${peak[0]}ì‹œ (${peak[1]}ê±´)&lt;/li&gt;
      &lt;li&gt;íŒ¨í„´ ìœ í˜•: ${getTimePatternType(hourly)}&lt;/li&gt;
      &lt;li&gt;ê¶Œê³ : ${getTimeRecommendation(peak[0])}&lt;/li&gt;
    `;
  }

  function analyzeFunctionPatterns() {
    const funcByTime = {};
    data.forEach(d =&gt; {
      if (!d.func) return;
      const hour = parseInt(d.time) || 0;
      const key = `${d.func}-${hour}ì‹œ`;
      funcByTime[key] = (funcByTime[key] || 0) + 1;
    });
    
    const sorted = Object.entries(funcByTime).sort((a,b) =&gt; b[1] - a[1]).slice(0, 3);
    if (sorted.length === 0) return &#x27;ê¸°ëŠ¥ íŒ¨í„´ ë°ì´í„° ë¶€ì¡±&#x27;;
    
    return sorted.map(([key, count]) =&gt; 
      `&lt;li&gt;${key}: ${count}íšŒ&lt;/li&gt;`
    ).join(&#x27;&#x27;);
  }

  function getTimePatternType(hourly) {
    const values = Object.values(hourly);
    const avg = values.reduce((a,b) =&gt; a+b, 0) / values.length;
    const variance = values.reduce((sum, v) =&gt; sum + Math.pow(v - avg, 2), 0) / values.length;
    
    if (variance &lt; avg * 0.5) return &#x27;ê· ë“± ë¶„í¬í˜•&#x27;;
    if (variance &gt; avg * 2) return &#x27;íŠ¹ì • ì‹œê°„ ì§‘ì¤‘í˜•&#x27;;
    return &#x27;ë¶ˆê·œì¹™ ë¶„í¬í˜•&#x27;;
  }

  function getTimeRecommendation(peakHour) {
    const hour = parseInt(peakHour);
    if (hour &lt; 10) return &#x27;ì•„ì¹¨ ë£¨í‹´ ê°•í™”, ë‹¨ê³„ì  í™œë™ ì‹œì‘&#x27;;
    if (hour &lt; 12) return &#x27;ì¤‘ê°„ íœ´ì‹ ì œê³µ, ê°ê° íœ´ì‹&#x27;;
    if (hour &lt; 14) return &#x27;ì ì‹¬ ì „í›„ êµ¬ì¡°í™”ëœ í™œë™&#x27;;
    if (hour &lt; 16) return &#x27;ì˜¤í›„ ì—ë„ˆì§€ ê´€ë¦¬, ì„ íƒ í™œë™&#x27;;
    return &#x27;ì¢…ì¼ í”„ë¡œê·¸ë¨ ê²€í†  í•„ìš”&#x27;;
  }

  function getHighRiskCombination() {
    const combos = {};
    data.forEach(d =&gt; {
      const combo = `${d.setting}-${d.time}`;
      combos[combo] = (combos[combo] || 0) + 1;
    });
    
    const top = Object.entries(combos).sort((a,b) =&gt; b[1] - a[1])[0];
    return top ? `${top[0]} (${top[1]}ê±´)` : &#x27;íŒ¨í„´ ë¯¸í™•ì¸&#x27;;
  }

  function getProtectiveFactors() {
    // Analyze days/times with no incidents
    const allDates = data.map(d =&gt; d.dateKey);
    const uniqueDates = new Set(allDates);
    
    if (uniqueDates.size &lt; 7) return &#x27;ë” ë§ì€ ë°ì´í„° í•„ìš”&#x27;;
    
    // Simple heuristic: if certain days have fewer incidents
    const dowCounts = {};
    data.forEach(d =&gt; {
      const dow = mapWeekday(d);
      dowCounts[dow] = (dowCounts[dow] || 0) + 1;
    });
    
    const minDow = Object.entries(dowCounts).sort((a,b) =&gt; a[1] - b[1])[0];
    return minDow ? `${minDow[0]}ìš”ì¼ í™œë™/êµ¬ì¡°` : &#x27;ë¶„ì„ ì¤‘&#x27;;
  }

  function getEarlyWarnings() {
    const warnings = [];
    
    // Check intensity escalation
    const highIntensity = data.filter(d =&gt; d.intensity &gt;= 4).length;
    if (highIntensity &gt; data.length * 0.2) {
      warnings.push(&#x27;ë†’ì€ ê°•ë„ ë¹„ìœ¨ 20% ì´ˆê³¼&#x27;);
    }
    
    // Check frequency increase
    const recent = data.slice(-10);
    const older = data.slice(-20, -10);
    if (recent.length &gt; older.length * 1.5) {
      warnings.push(&#x27;ìµœê·¼ ë¹ˆë„ ê¸‰ì¦&#x27;);
    }
    
    // Check function diversity
    const functions = new Set(data.map(d =&gt; d.func).filter(Boolean));
    if (functions.size &gt;= 4) {
      warnings.push(&#x27;ë‹¤ì¤‘ ê¸°ëŠ¥ ë³µì¡ì„±&#x27;);
    }
    
    return warnings.length &gt; 0 ? warnings.join(&#x27;, &#x27;) : &#x27;ì •ìƒ ë²”ìœ„&#x27;;
  }

  function renderRiskMatrix() {
    const matrix = `
      &lt;table class=&quot;table&quot;&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th&gt;ì‹œê°„ëŒ€&lt;/th&gt;
            &lt;th&gt;ì›”&lt;/th&gt;
            &lt;th&gt;í™”&lt;/th&gt;
            &lt;th&gt;ìˆ˜&lt;/th&gt;
            &lt;th&gt;ëª©&lt;/th&gt;
            &lt;th&gt;ê¸ˆ&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
          ${generateRiskMatrixRows()}
        &lt;/tbody&gt;
      &lt;/table&gt;
      &lt;div class=&quot;small&quot; style=&quot;margin-top: 10px;&quot;&gt;
        &lt;span style=&quot;background:#C6F6D5; padding:2px 6px;&quot;&gt;ë‚®ìŒ(0-1)&lt;/span&gt;
        &lt;span style=&quot;background:#FED7AA; padding:2px 6px;&quot;&gt;ì¤‘ê°„(2-3)&lt;/span&gt;
        &lt;span style=&quot;background:#FED7D7; padding:2px 6px;&quot;&gt;ë†’ìŒ(4+)&lt;/span&gt;
      &lt;/div&gt;
    `;
    $(&#x27;riskMatrix&#x27;).innerHTML = matrix;
  }

  function generateRiskMatrixRows() {
    const matrix = {};
    
    // Build matrix data
    data.forEach(d =&gt; {
      const hour = parseInt(d.time) || 0;
      const dow = mapWeekday(d);
      const key = `${hour}-${dow}`;
      matrix[key] = (matrix[key] || 0) + 1;
    });
    
    // Generate rows for hours 9-16
    const rows = [];
    for (let hour = 9; hour &lt;= 16; hour++) {
      const cells = [&#x27;ì›”&#x27;, &#x27;í™”&#x27;, &#x27;ìˆ˜&#x27;, &#x27;ëª©&#x27;, &#x27;ê¸ˆ&#x27;].map(dow =&gt; {
        const count = matrix[`${hour}-${dow}`] || 0;
        const color = count === 0 ? &#x27;#f0f0f0&#x27; : 
                     count &lt;= 1 ? &#x27;#C6F6D5&#x27; :
                     count &lt;= 3 ? &#x27;#FED7AA&#x27; : &#x27;#FED7D7&#x27;;
        return `&lt;td style=&quot;background:${color}; text-align:center;&quot;&gt;${count}&lt;/td&gt;`;
      }).join(&#x27;&#x27;);
      rows.push(`&lt;tr&gt;&lt;td&gt;${hour}ì‹œ&lt;/td&gt;${cells}&lt;/tr&gt;`);
    }
    
    return rows.join(&#x27;&#x27;);
  }

  function renderCorrelationAnalysis() {
    const analysis = `
      &lt;h4&gt;1. í–‰ë™-ê°•ë„ ìƒê´€ê´€ê³„&lt;/h4&gt;
      &lt;div class=&quot;insight-box&quot;&gt;
        ${analyzeBehaviorIntensity()}
      &lt;/div&gt;
      
      &lt;h4&gt;2. ê¸°ëŠ¥-ì¥ì†Œ ìƒê´€ê´€ê³„&lt;/h4&gt;
      &lt;div class=&quot;insight-box&quot;&gt;
        ${analyzeFunctionSetting()}
      &lt;/div&gt;
      
      &lt;h4&gt;3. ì„ í–‰ì‚¬ê±´-ê²°ê³¼ íš¨ê³¼ì„±&lt;/h4&gt;
      &lt;div class=&quot;insight-box&quot;&gt;
        ${analyzeAntecedentConsequence()}
      &lt;/div&gt;
    `;
    $(&#x27;correlationAnalysis&#x27;).innerHTML = analysis;
  }

  function analyzeBehaviorIntensity() {
    const behaviorIntensity = {};
    data.forEach(d =&gt; {
      if (!behaviorIntensity[d.behavior]) {
        behaviorIntensity[d.behavior] = [];
      }
      behaviorIntensity[d.behavior].push(d.intensity);
    });
    
    const analysis = Object.entries(behaviorIntensity)
      .map(([behavior, intensities]) =&gt; {
        const avg = (intensities.reduce((a,b) =&gt; a+b, 0) / intensities.length).toFixed(1);
        return { behavior, avg: parseFloat(avg), count: intensities.length };
      })
      .sort((a,b) =&gt; b.avg - a.avg)
      .slice(0, 3)
      .map(({behavior, avg, count}) =&gt; 
        `&lt;li&gt;${behavior}: í‰ê·  ê°•ë„ ${avg} (n=${count})&lt;/li&gt;`
      ).join(&#x27;&#x27;);
    
    return analysis || &#x27;ë°ì´í„° ë¶€ì¡±&#x27;;
  }

  function analyzeFunctionSetting() {
    const funcSetting = {};
    data.forEach(d =&gt; {
      if (d.func &amp;&amp; d.setting) {
        const key = `${d.func} â†’ ${d.setting}`;
        funcSetting[key] = (funcSetting[key] || 0) + 1;
      }
    });
    
    const sorted = Object.entries(funcSetting)
      .sort((a,b) =&gt; b[1] - a[1])
      .slice(0, 3)
      .map(([key, count]) =&gt; 
        `&lt;li&gt;${key}: ${count}íšŒ&lt;/li&gt;`
      ).join(&#x27;&#x27;);
    
    return sorted || &#x27;ë°ì´í„° ë¶€ì¡±&#x27;;
  }

  function analyzeAntecedentConsequence() {
    const antCon = {};
    data.forEach(d =&gt; {
      if (d.antecedent &amp;&amp; d.consequence) {
        const key = `${d.antecedent} â†’ ${d.consequence}`;
        antCon[key] = (antCon[key] || 0) + 1;
      }
    });
    
    const sorted = Object.entries(antCon)
      .sort((a,b) =&gt; b[1] - a[1])
      .slice(0, 3)
      .map(([key, count]) =&gt; 
        `&lt;li&gt;${key}: ${count}íšŒ (íŒ¨í„´ ê²€í†  í•„ìš”)&lt;/li&gt;`
      ).join(&#x27;&#x27;);
    
    return sorted || &#x27;ë°ì´í„° ë¶€ì¡±&#x27;;
  }

  function exportFBA(student) {
    const rows = data.filter(d =&gt; d.student === student);
    const csv = Papa.unparse(rows);
    const blob = new Blob([csv], { type: &#x27;text/csv&#x27; });
    const url = URL.createObjectURL(blob);
    const a = document.createElement(&#x27;a&#x27;);
    a.href = url;
    a.download = `FBA_${student}_${new Date().toISOString().split(&#x27;T&#x27;)[0]}.csv`;
    a.click();
  }

  function showModal(){ $(&#x27;modal&#x27;).style.display=&#x27;flex&#x27;; }
  function hideModal(){ $(&#x27;modal&#x27;).style.display=&#x27;none&#x27;; }
  function closeModal(e){ if(e.target.id===&#x27;modal&#x27;) hideModal(); }

  window.openFBA = openFBA;
  window.exportFBA = exportFBA;
  window.showTab = (ev,id)=&gt;{
    document.querySelectorAll(&#x27;.tab&#x27;).forEach(t=&gt; t.classList.remove(&#x27;active&#x27;));
    ev.target.classList.add(&#x27;active&#x27;);
    document.querySelectorAll(&#x27;.tab-content&#x27;).forEach(x=&gt; x.classList.remove(&#x27;active&#x27;));
    $(id).classList.add(&#x27;active&#x27;);
  };
&lt;/script&gt;

&lt;script&gt;
(function(){
  function ensureOverlay(){
    if(!document.getElementById(&#x27;keZoomOverlay&#x27;)){
      var wrapper = document.createElement(&#x27;div&#x27;);
      wrapper.innerHTML = `
&lt;div class=&quot;ke-zoom-overlay&quot; id=&quot;keZoomOverlay&quot;&gt;
  &lt;div class=&quot;ke-zoom-close&quot; id=&quot;keZoomClose&quot;&gt;âœ•&lt;/div&gt;
  &lt;div class=&quot;ke-zoom-box&quot;&gt;&lt;img id=&quot;keZoomImg&quot; alt=&quot;zoomed chart&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
`;
      document.body.appendChild(wrapper.firstElementChild);
    }
  }
  function toPNG(canvas){
    try{
      return canvas.toDataURL(&#x27;image/png&#x27;, 1.0);
    }catch(e){ return null; }
  }
  function attach(){
    ensureOverlay();
    var overlay = document.getElementById(&#x27;keZoomOverlay&#x27;);
    var img = document.getElementById(&#x27;keZoomImg&#x27;);
    var close = document.getElementById(&#x27;keZoomClose&#x27;);
    function hide(){ overlay.style.display = &#x27;none&#x27;; img.src=&#x27;&#x27;; }
    close.addEventListener(&#x27;click&#x27;, hide);
    overlay.addEventListener(&#x27;click&#x27;, function(e){ if(e.target===overlay) hide(); });
    var canvases = document.querySelectorAll(&#x27;canvas&#x27;);
    canvases.forEach(function(c){
      c.style.cursor = &#x27;zoom-in&#x27;;
      c.addEventListener(&#x27;click&#x27;, function(){
        var url = toPNG(c);
        if(url){
          img.src = url;
          overlay.style.display = &#x27;flex&#x27;;
        }
      });
    });
  }
  if(document.readyState===&#x27;loading&#x27;){
    document.addEventListener(&#x27;DOMContentLoaded&#x27;, attach);
  }else{
    attach();
  }
})();
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;" style="width:100%;height:100%;border:none;border-radius:12px;box-shadow:inset 0 0 0 1px #e5e7eb;"></iframe>
    </div>
    <p class="note">ğŸ“ˆ ì›ë³¸ ëŒ€ì‹œë³´ë“œ ë‚´ì˜ ëª¨ë“  ê·¸ë˜í”„ëŠ” í´ë¦­í•˜ë©´ í¬ê²Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤(í”„ë ˆì„ ë‚´ë¶€ í™•ëŒ€ ê¸°ëŠ¥ íƒ‘ì¬).</p>
  </section>

  <section id="studentChart" class="tabpanel">
    <div class="controls">
      <label for="excelUpload">ğŸ“‚ ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ (xlsx, xls):</label>
      <input type="file" id="excelUpload" accept=".xlsx,.xls,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel" style="max-width:320px">
      <button id="loadExcel">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>
    <div class="controls">
      <label for="studentSelect">í•™ìƒ ì„ íƒ:</label>
      <select id="studentSelect"></select>
      <button id="downloadPNG">PNG ì €ì¥</button>
    </div>
    <div class="canvas-wrap">
      <canvas id="chartCanvas" height="160"></canvas>
    </div>
    <p class="note">
      ë²”ìœ„: 1~42ì£¼ì°¨ (ì „ì²´ í•™ë…„ë„). ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ìë™ìœ¼ë¡œ ì£¼ì°¨ë³„ ë°ì´í„°ë¥¼ ì§‘ê³„í•©ë‹ˆë‹¤.
    </p>
  </section>
</div>

<div class="zoom-overlay" id="zoomOverlay">
  <div class="zoom-close" id="zoomClose">âœ•</div>
  <div class="zoom-box"><img id="zoomImg" alt="zoomed chart"></div>
</div>

<footer>Â© Gyeong-eun PBS â€¢ Chart zoom: click any chart</footer>

<script>
// Tabs
document.querySelectorAll('.tab').forEach(tab => { 
  tab.addEventListener('click', () => { 
    document.querySelectorAll('.tab, .tabpanel').forEach(el => el.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.for).classList.add('active');
  });
});

// Embedded dataset (extended to 42 weeks)
const WEEK_LABELS = [];
for (let i = 1; i <= 42; i++) { WEEK_LABELS.push(i + 'ì£¼ì°¨'); }

// Initialize with existing data (extended to 42 weeks)
let DATA = {"ê°•ê·œë¹ˆ": [0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ê¹€ë¯¼ì£¼": [4, 5, 4, 0, 1, 4, 4, 4, 2, 3, 4, 4, 3, 1, 3, 3, 5, 0, 2, 2, 1, 2, 2, 4, 4, 3, 3, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ê¹€ë¯¼ì¤€": [0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ê¹€ì˜ë¯¼": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ê¹€ì˜ˆì›": [0, 1, 0, 0, 1, 0, 2, 2, 0, 2, 1, 1, 1, 1, 2, 3, 2, 0, 1, 0, 0, 0, 0, 2, 0, 4, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ê¹€ìœ ì§„": [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ê¹€ì§€ì„±": [0, 2, 2, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 2, 3, 0, 0, 0, 1, 0, 4, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ê¹€íƒœì¡°": [0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ê¹€íš¨ë¦°": [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ë°•ê°€ì˜¨": [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ë°•ë‹¤ì†œ": [0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ë°•ë¯¼í˜": [3, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ë°©ì„ í˜¸": [0, 0, 2, 3, 0, 2, 6, 2, 0, 0, 0, 3, 1, 0, 0, 3, 0, 0, 2, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ë°°ì§„ìˆ˜": [1, 1, 0, 0, 2, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì†ìœ ë¯¼": [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì•ˆì§€ìœ ": [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì–‘ì¤€ë¯¼": [2, 2, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì–´íƒœì›": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ìš°ì„œìš°": [1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ìœ¤ì˜ˆì°¬": [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ìœ¤ì£¼í•˜": [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì´ë¯¼í˜": [2, 1, 1, 1, 2, 1, 2, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì´ì—˜": [0, 0, 0, 0, 0, 0, 0, 1, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì´ì¢…ì›": [0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì´ì§„í˜¸": [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì´ì±„ì›": [0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì´í•œìœ¨": [0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì´í˜„ì¤€": [0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì¥ì¬í˜•": [1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì¥ì°¬": [0, 0, 0, 0, 0, 0, 2, 1, 0, 3, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì „ì„±ì§„": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 3, 5, 3, 4, 1, 2, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì •ë¯¼ì¬": [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì •ì¬ë¯¼": [0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ì •ì¬ìœ¤": [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "ìµœìš°ë¹ˆ": [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "í™ë°ˆì¹¸": [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]};
let STUDENTS = Object.keys(DATA);

// Helper function to convert Excel date to JavaScript Date
function excelDateToJSDate(excelDate) {
  // If it's already a Date object, return it
  if (excelDate instanceof Date) return excelDate;

  // If it's a string that looks like a date
  if (typeof excelDate === 'string') {
    const parsed = new Date(excelDate);
    if (!isNaN(parsed.getTime())) return parsed;
  }

  // If it's an Excel serial number (numeric)
  if (typeof excelDate === 'number') {
    // Excel date serial number (days since 1900-01-01, but Excel has a bug for 1900)
    const excelEpoch = new Date(1899, 11, 30); // Dec 30, 1899
    const jsDate = new Date(excelEpoch.getTime() + excelDate * 86400000);
    return jsDate;
  }

  return null;
}

// Helper function to convert date to week number (1-42)
function dateToWeekNumber(dateValue) {
  if (!dateValue) return null;

  try {
    // Convert Excel date to JS Date
    const date = excelDateToJSDate(dateValue);
    if (!date || isNaN(date.getTime())) return null;

    // School year starts at 2025-03-03 (Monday of week 10, 2025)
    const startDate = new Date('2025-03-03');
    const diffTime = date - startDate;
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    const weekNum = Math.floor(diffDays / 7) + 1;

    // Constrain to 1-42 weeks
    if (weekNum < 1 || weekNum > 42) return null;
    return weekNum;
  } catch (e) {
    console.error('Date conversion error:', e, dateValue);
    return null;
  }
}

// Parse Excel file and update DATA
function parseExcelData(arrayBuffer) {
  // Check if XLSX library is loaded
  if (typeof XLSX === 'undefined') {
    alert('âŒ Excel íŒŒì‹± ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
    console.error('XLSX library not loaded');
    return;
  }

  try {
    const workbook = XLSX.read(arrayBuffer, { type: 'array', cellDates: true });
    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1, raw: false, dateNF: 'yyyy-mm-dd' });

    console.log('ğŸ“Š Excel íŒŒì‹± ì‹œì‘:', workbook.SheetNames[0]);
    console.log('ì´ í–‰ ìˆ˜:', rows.length);

    // Initialize new data structure
    const newData = {};
    let successCount = 0;
    let errorCount = 0;
    const errors = [];

    // Process each row (skip header)
    for (let i = 1; i < rows.length; i++) {
      const row = rows[i];
      if (!row || row.length < 6) {
        errorCount++;
        continue;
      }

      // Extract fields based on the table structure shown
      // Columns: ë²ˆí˜¸(0), ì…ë ¥êµì‚¬(1), í•™ìƒëª…(2), ì½”ë“œë²ˆí˜¸(3), ì…ë ¥ì¼(4), í–‰ë™ë°œìƒë‚ ì§œ(5), í–‰ë™ìœ í˜•(6), ë°œìƒë¹ˆë„(7), etc.
      const studentName = row[2]; // í•™ìƒëª… (column index 2)
      const behaviorDate = row[5]; // í–‰ë™ë°œìƒ ë‚ ì§œ (column index 5)
      const frequency = row[7] || 1; // ë°œìƒë¹ˆë„(íšŒ) (column index 7), default to 1

      if (!studentName) {
        errorCount++;
        continue;
      }

      if (!behaviorDate) {
        errorCount++;
        errors.push(`í–‰ ${i + 1}: ${studentName} - ë‚ ì§œ ì—†ìŒ`);
        continue;
      }

      // Convert date to week number
      const weekNum = dateToWeekNumber(behaviorDate);

      if (weekNum === null) {
        errorCount++;
        errors.push(`í–‰ ${i + 1}: ${studentName} - ë‚ ì§œ ë²”ìœ„ ë²—ì–´ë‚¨ (${behaviorDate})`);
        continue;
      }

      // Initialize student if not exists
      if (!newData[studentName]) {
        newData[studentName] = new Array(42).fill(0);
      }

      // Add frequency to the appropriate week (weekNum-1 for 0-indexed array)
      const freq = (typeof frequency === 'number' ? frequency : parseInt(frequency) || 1);
      newData[studentName][weekNum - 1] += freq;
      successCount++;
    }

    console.log('âœ… íŒŒì‹± ì„±ê³µ:', successCount, 'ê±´');
    console.log('âŒ íŒŒì‹± ì‹¤íŒ¨:', errorCount, 'ê±´');
    if (errors.length > 0 && errors.length <= 10) {
      console.log('ì˜¤ë¥˜ ìƒì„¸:', errors);
    }

    // Check if we got any data
    if (Object.keys(newData).length === 0) {
      alert('âš ï¸ ì—‘ì…€ íŒŒì¼ì—ì„œ ìœ íš¨í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì»¬ëŸ¼ êµ¬ì¡°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”:\n- Column 3: í•™ìƒëª…\n- Column 6: í–‰ë™ë°œìƒë‚ ì§œ\n- Column 8: ë°œìƒë¹ˆë„(íšŒ)');
      return;
    }

    // Update global DATA and STUDENTS
    DATA = newData;
    STUDENTS = Object.keys(DATA).sort();

    // Refresh dropdown
    refreshStudentDropdown();

    // Show success message
    let message = `âœ… ì—‘ì…€ ë°ì´í„° íŒŒì‹± ì™„ë£Œ!\n\n`;
    message += `ğŸ“Œ í•™ìƒ ìˆ˜: ${STUDENTS.length}ëª…\n`;
    message += `ğŸ“Œ ì´ ë°ì´í„°: ${successCount}ê±´\n`;
    message += `ğŸ“Œ ì²˜ë¦¬ëœ í–‰: ${rows.length - 1}í–‰`;

    if (errorCount > 0) {
      message += `\n\nâš ï¸ ê±´ë„ˆë›´ ë°ì´í„°: ${errorCount}ê±´`;
      if (errors.length > 0 && errors.length <= 5) {
        message += '\n\nì˜¤ë¥˜ ì˜ˆì‹œ:\n' + errors.slice(0, 5).join('\n');
      }
    }

    alert(message);

    // Recreate chart with first student
    if (STUDENTS.length > 0) {
      createChart(STUDENTS[0]);
    }
  } catch (error) {
    alert('âŒ ì—‘ì…€ íŒŒì¼ íŒŒì‹± ì˜¤ë¥˜\n\n' + error.message + '\n\níŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
    console.error('Excel parsing error:', error);
  }
}

// Refresh student dropdown
function refreshStudentDropdown() {
  studentSelect.innerHTML = '';
  if (STUDENTS.length === 0) {
    const opt = document.createElement('option');
    opt.value = 'ë°ì´í„° ì—†ìŒ';
    opt.textContent = 'ë°ì´í„° ì—†ìŒ';
    studentSelect.appendChild(opt);
  } else {
    STUDENTS.forEach(s => {
      const opt = document.createElement('option');
      opt.value = s;
      opt.textContent = s;
      studentSelect.appendChild(opt);
    });
  }
}

// Populate dropdown
const studentSelect = document.getElementById('studentSelect');
refreshStudentDropdown();

// Excel file upload handler
document.getElementById('loadExcel').addEventListener('click', () => {
  const fileInput = document.getElementById('excelUpload');
  const file = fileInput.files[0];

  if (!file) {
    alert('âš ï¸ ë¨¼ì € ì—‘ì…€ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }

  // Validate file type
  const fileName = file.name.toLowerCase();
  const validExtensions = ['.xlsx', '.xls'];
  const hasValidExtension = validExtensions.some(ext => fileName.endsWith(ext));

  if (!hasValidExtension) {
    alert('âŒ ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.\n\nì§€ì› í˜•ì‹: .xlsx, .xls\nì„ íƒí•œ íŒŒì¼: ' + file.name);
    return;
  }

  console.log('ğŸ“‚ íŒŒì¼ ì„ íƒë¨:', file.name, 'í¬ê¸°:', (file.size / 1024).toFixed(2) + 'KB');

  const reader = new FileReader();
  reader.onload = (e) => {
    console.log('âœ… íŒŒì¼ ì½ê¸° ì™„ë£Œ, íŒŒì‹± ì‹œì‘...');
    parseExcelData(e.target.result);
  };
  reader.onerror = () => {
    alert('âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜\n\níŒŒì¼ì´ ì†ìƒë˜ì—ˆê±°ë‚˜ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    console.error('FileReader error:', reader.error);
  };
  reader.readAsArrayBuffer(file);
});

// Chart setup
Chart.register(ChartDataLabels);
const ctx = document.getElementById('chartCanvas').getContext('2d');
let chart;

function buildDatasetFor(studentName) {
  const values = (DATA[studentName] || Array(WEEK_LABELS.length).fill(0)).map(v => (typeof v === 'number' ? v : 0));
  // Colors: 1~21 (1í•™ê¸°) red, 22~42 (2í•™ê¸°) blue
  const pointBackgroundColor = values.map((_, i) => i < 21 ? '#ef4444' : '#3b82f6');
  const pointBorderColor = pointBackgroundColor;
  return { values, pointBackgroundColor, pointBorderColor };
}

function createChart(studentName) {
  const ds = buildDatasetFor(studentName);
  if (chart) { chart.destroy(); }
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: WEEK_LABELS,
      datasets: [{
        label: `2025í•™ë…„ë„ ${studentName} í•™ìƒ ìœ„ê¸°í–‰ë™ ë°œìƒ ë¹ˆë„ ê·¸ë˜í”„`,
        data: ds.values,
        borderColor: '#64748b',
        backgroundColor: 'rgba(100,116,139,0.08)',
        tension: 0.2,
        pointRadius: 5,
        pointHoverRadius: 7,
        pointHitRadius: 12,
        pointStyle: 'circle',
        pointBackgroundColor: ds.pointBackgroundColor,
        pointBorderColor: ds.pointBorderColor,
        spanGaps: false,
        segment: { borderColor: ctx => {
          // Break line between 21st (index 20) and 22nd (index 21)
          const i = ctx.p0DataIndex;
          if (i === 20) { return 'rgba(0,0,0,0)'; }
          return '#94a3b8';
        }}
      }]
    },
    options: {
      plugins: {
        legend: { display: false },
        title: {
          display: true,
          text: `2025í•™ë…„ë„ ${studentName} í•™ìƒ ìœ„ê¸°í–‰ë™ ë°œìƒ ë¹ˆë„ ê·¸ë˜í”„`,
          font: { size: 18, weight: '600' }
        },
        datalabels: {
          anchor: 'end', align: 'top',
          formatter: (v) => (v==null ? '' : v),
          clip: false,
          offset: 4
        },
        tooltip: {
          callbacks: {
            title: (items)=> items[0].label,
            label: (ctx)=> `ë¹ˆë„: ${ctx.parsed.y ?? 0}`
          }
        }
      },
      scales: {
        y: {
          suggestedMin: 0,
          suggestedMax: 10,
          ticks: { stepSize: 1 }
        },
        x: {
          ticks: { autoSkip: false, maxRotation: 0, minRotation: 0 }
        }
      }
    }
  });
}

// Initial render
createChart(studentSelect.value);

// Change handler
studentSelect.addEventListener('change', () => createChart(studentSelect.value));

// Download button
document.getElementById('downloadPNG').addEventListener('click', () => {
  const link = document.createElement('a');
  link.download = `${studentSelect.value}_ì£¼ì°¨ë³„_ìœ„ê¸°í–‰ë™ë¹ˆë„.png`;
  link.href = document.getElementById('chartCanvas').toDataURL('image/png', 1.0);
  link.click();
});

// Parent-page chart zoom
(function(){
  const overlay = document.getElementById('zoomOverlay');
  const img = document.getElementById('zoomImg');
  const close = document.getElementById('zoomClose');
  function hide(){ overlay.style.display='none'; img.src=''; }
  close.addEventListener('click', hide);
  overlay.addEventListener('click', e=>{ if(e.target===overlay) hide(); });
  document.getElementById('chartCanvas').style.cursor='zoom-in';
  document.getElementById('chartCanvas').addEventListener('click', ()=>{
    img.src = document.getElementById('chartCanvas').toDataURL('image/png', 1.0);
    overlay.style.display = 'flex';
  });
})();
</script>
</body>
</html>
